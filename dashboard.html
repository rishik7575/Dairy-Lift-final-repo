<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dairy Farm Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #8B5CF6;
      --primary-light: rgba(139, 92, 246, 0.2);
      --secondary: #22C55E;
      --accent: #F59E0B;
      --blue: #3B82F6;
      --muted: #6B7280;
      --muted-foreground: #9CA3AF;
      --background: #FFFFFF;
      --foreground: #111827;
      --border: #E5E7EB;
      --radius: 0.5rem;
    }
    
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: var(--background);
      color: var(--foreground);
    }
    
    .dashboard-card {
      background-color: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
      transition: all 0.2s ease;
    }
    
    .dashboard-card:hover {
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
    }
    
    .stat-label {
      font-size: 0.875rem;
      color: var(--muted);
    }
    
    .trend-up {
      color: var(--secondary);
      display: flex;
      align-items: center;
    }
    
    .trend-down {
      color: #EF4444;
      display: flex;
      align-items: center;
    }
    
    .health-excellent {
      background-color: rgba(34, 197, 94, 0.1);
      color: rgb(21, 128, 61);
    }
    
    .health-good {
      background-color: rgba(59, 130, 246, 0.1);
      color: rgb(29, 78, 216);
    }
    
    .health-fair {
      background-color: rgba(245, 158, 11, 0.1);
      color: rgb(180, 83, 9);
    }
    
    .health-poor {
      background-color: rgba(239, 68, 68, 0.1);
      color: rgb(185, 28, 28);
    }
    
    .navbar {
      background-color: white;
      border-bottom: 1px solid var(--border);
      padding: 0.75rem 1rem;
    }
    
    .footer {
      background-color: #F9FAFB;
      border-top: 1px solid var(--border);
      padding: 2rem 0;
    }
    
    .progress-bar {
      height: 0.5rem;
      background-color: #F3F4F6;
      border-radius: 9999px;
      overflow: hidden;
    }
    
    .progress-bar-fill {
      height: 100%;
      border-radius: 9999px;
      background-color: var(--primary);
      transition: width 1s ease-in-out;
    }
    
    /* Animation classes */
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: .7;
      }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
      padding-top: 60px;
    }
    
    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      width: 80%;
      max-width: 800px;
      animation: modalOpen 0.3s ease-out;
    }
    
    @keyframes modalOpen {
      from {opacity: 0; transform: scale(0.95);}
      to {opacity: 1; transform: scale(1);}
    }
    
    .close {
      color: var(--muted);
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close:hover,
    .close:focus {
      color: var(--foreground);
      text-decoration: none;
    }
    
    /* Custom iframe styling */
    .no-scroll-iframe {
      overflow: hidden;
      width: 100%;
      border: none;
    }

    .content-iframe {
      width: 100%;
      border: none;
    }
    
    /* Hide scrollbars but allow scrolling */
    .custom-scrollbar {
      overflow-y: auto;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none;  /* IE and Edge */
    }
    .custom-scrollbar::-webkit-scrollbar {
      display: none; /* Chrome, Safari and Opera */
    }

    /* Toast notification */
    .toast {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 0.75rem 1rem;
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 50;
      transform: translateY(-10px);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .toast.info {
      background-color: #EFF6FF;
      border-left: 4px solid #3B82F6;
      color: #1E3A8A;
    }
    
    .toast.success {
      background-color: #ECFDF5;
      border-left: 4px solid #10B981;
      color: #065F46;
    }
    
    .toast.error {
      background-color: #FEF2F2;
      border-left: 4px solid #EF4444;
      color: #991B1B;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Navbar -->
  <nav class="navbar flex justify-between items-center">
    <div class="flex items-center">
      <h1 class="text-xl font-bold text-purple-600">DairyVest</h1>
      <div class="hidden md:flex space-x-4 ml-10">
        <a href="home_page.html" class="text-gray-700 hover:text-purple-600">Home</a>
        <a href="dashboard.html" class="text-gray-500 hover:text-purple-600">Dashboard</a>
        <a href="store.html" class="text-gray-500 hover:text-purple-600">Store</a>
        <a href="admin-dashboard.html" class="text-gray-500 hover:text-purple-600">Admin</a>
      </div>
    </div>
    <div class="flex items-center space-x-4">
      <button class="p-2 rounded-full hover:bg-gray-100">
        <i class="fas fa-bell text-gray-500"></i>
      </button>
      <div class="flex items-center space-x-2">
        <div class="w-8 h-8 rounded-full bg-purple-200 flex items-center justify-center">
          <span class="text-sm font-medium text-purple-700">JD</span>
        </div>
        <span class="hidden md:inline text-sm font-medium">John Doe</span>
      </div>
    </div>
  </nav>

  <div class="flex-grow bg-gray-50 py-6">
    <div class="container mx-auto px-4">
      <!-- Dashboard Header -->
      <div class="mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
          <h1 class="text-3xl font-bold">Welcome back, John</h1>
          <p class="text-gray-500">
            Here's the latest updates on your dairy farm investments
          </p>
        </div>
        <div class="flex items-center space-x-2">
          <div class="dropdown relative">
            <button id="exportBtn" class="hidden sm:flex items-center px-4 py-2 border border-gray-300 rounded-md bg-white hover:bg-gray-50 transition-colors">
              <i class="fas fa-download mr-2 text-sm"></i>
              Export Data
              <i class="fas fa-chevron-down ml-2 text-sm"></i>
            </button>
            <div id="exportDropdown" class="dropdown-menu hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-10">
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" onclick="exportData('csv')">Export as CSV</a>
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" onclick="exportData('xlsx')">Export as Excel</a>
              <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" onclick="exportData('pdf')">Export as PDF</a>
            </div>
          </div>
          
          <button id="liveFeedBtn" class="flex items-center px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors">
            <i class="fas fa-external-link-alt mr-2 text-sm"></i>
            Live Feed
          </button>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="dashboard-card p-4">
          <div class="flex justify-between items-start">
            <div>
              <p class="stat-label mb-1">Total Investment</p>
              <p class="stat-value">₹10,500</p>
            </div>
            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
              <i class="fas fa-money-bill-wave text-blue-500"></i>
            </div>
          </div>
          <div class="flex items-center mt-2">
            <p class="trend-up text-xs">
              <i class="fas fa-arrow-up mr-1"></i>
              5% from last month
            </p>
          </div>
        </div>

        <div class="dashboard-card p-4">
          <div class="flex justify-between items-start">
            <div>
              <p class="stat-label mb-1">Monthly Yield</p>
              <p class="stat-value">₹620</p>
            </div>
            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
              <i class="fas fa-chart-line text-green-500"></i>
            </div>
          </div>
          <div class="flex items-center mt-2">
            <p class="trend-up text-xs">
              <i class="fas fa-arrow-up mr-1"></i>
              12% from last month
            </p>
          </div>
        </div>

        <div class="dashboard-card p-4">
          <div class="flex justify-between items-start">
            <div>
              <p class="stat-label mb-1">Total Earnings</p>
              <p class="stat-value">₹4,250</p>
            </div>
            <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
              <i class="fas fa-calendar text-purple-500"></i>
            </div>
          </div>
          <div class="flex items-center mt-2">
            <p class="trend-up text-xs">
              <i class="fas fa-arrow-up mr-1"></i>
              8% from last month
            </p>
          </div>
        </div>

        <div class="dashboard-card p-4">
          <div class="flex justify-between items-start">
            <div>
              <p class="stat-label mb-1">Avg. Milk Production</p>
              <p class="stat-value">29 L/day</p>
            </div>
            <div class="w-10 h-10 rounded-full bg-sky-100 flex items-center justify-center">
              <i class="fas fa-tint text-sky-500"></i>
            </div>
          </div>
          <div class="flex items-center mt-2">
            <p class="trend-up text-xs">
              <i class="fas fa-arrow-up mr-1"></i>
              3% from last month
            </p>
          </div>
        </div>
      </div>

      <!-- Main Chart -->
      <div class="mb-8">
        <div class="dashboard-card">
          <div class="p-4 pb-2">
            <div class="flex justify-between items-center">
              <div>
                <h3 class="text-lg font-semibold">Milk Production Trend</h3>
                <p class="text-sm text-gray-500">Total milk production over the last 12 months</p>
              </div>
              <div class="flex items-center">
                <div class="w-3 h-3 rounded-full bg-purple-600 mr-2"></div>
                <span class="text-sm">Production (Liters)</span>
              </div>
            </div>
          </div>
          <div class="p-4">
            <div class="h-80">
              <canvas id="milkProductionChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Row 1 - ProfitForecast and MilkingEfficiency -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <div class="lg:col-span-2">
          <iframe src="ProfitForecast.html" frameborder="0" class="content-iframe" id="profit-forecast-frame"></iframe>
        </div>
        <div>
          <iframe src="MilkingEfficiencyCard.html" frameborder="0" class="content-iframe" id="milking-efficiency-frame"></iframe>
        </div>
      </div>

      <!-- Row 2 - Farm Stats and Expense Breakdown -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div>
          <iframe src="FarmStats.html" frameborder="0" class="content-iframe" id="farm-stats-frame"></iframe>
        </div>
        <div>
          <iframe src="ExpenseBreakdownChart.html" frameborder="0" class="content-iframe" id="expense-breakdown-frame"></iframe>
        </div>
      </div>

      <!-- Row 3 - Milk Wastage and Cattle Lifecycle -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div>
          <iframe src="MilkWastageTracker.html" frameborder="0" class="content-iframe" id="milk-wastage-frame"></iframe>
        </div>
        <div>
          <iframe src="CattleLifecycleTracker.html" frameborder="0" class="content-iframe" id="cattle-lifecycle-frame"></iframe>
        </div>
      </div>

      <!-- Row 4 - Weather, Waste to Profit, Investor Trust -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <div>
          <iframe src="WeatherImpactAnalytics.html" frameborder="0" class="content-iframe" id="weather-impact-frame"></iframe>
        </div>
        <div>
          <iframe src="WastetoProfitTracker.html" frameborder="0" class="content-iframe" id="waste-to-profit-frame"></iframe>
        </div>
        <div>
          <iframe src="InvestorTrust.html" frameborder="0" class="content-iframe" id="investor-trust-frame"></iframe>
        </div>
      </div>

      <!-- Cattle Section -->
      <div class="mb-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
          <h2 class="text-2xl font-bold">Your Cattle</h2>
          <div class="flex space-x-2 w-full md:w-auto">
            <select id="cattleFilter" class="border border-gray-300 rounded-md px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-purple-500 w-full md:w-[180px]">
              <option value="all">All Cattle</option>
              <option value="active">Active Lactation</option>
              <option value="dry">Dry Period</option>
            </select>
            <select id="sortOrder" class="border border-gray-300 rounded-md px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-purple-500 w-full md:w-[180px]">
              <option value="newest">Newest First</option>
              <option value="oldest">Oldest First</option>
              <option value="production">Highest Production</option>
            </select>
          </div>
        </div>
        <iframe id="cattleIframe" src="YourCattle.html" frameborder="0" class="content-iframe" height="600"></iframe>
      </div>

      <!-- Recent Updates & Upcoming Events -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <!-- Recent Updates -->
        <div class="lg:col-span-2 space-y-4">
          <h3 class="text-xl font-semibold">Recent Updates</h3>
          
          <div class="dashboard-card p-4 animate-fade-in">
            <div class="flex items-start space-x-3">
              <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-500">
                <i class="fas fa-check"></i>
              </div>
              <div class="flex-1">
                <div class="flex justify-between">
                  <h4 class="font-medium">Health Check Completed</h4>
                  <span class="text-sm text-gray-500">Today, 10:30 AM</span>
                </div>
                <p class="text-sm text-gray-600 mt-1">All your cattle have passed their monthly health check with excellent results.</p>
              </div>
            </div>
          </div>

          <div class="dashboard-card p-4 animate-fade-in" style="animation-delay: 0.1s;">
            <div class="flex items-start space-x-3">
              <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-500">
                <i class="fas fa-money-bill-wave"></i>
              </div>
              <div class="flex-1">
                <div class="flex justify-between">
                  <h4 class="font-medium">Dividend Payment Processed</h4>
                  <span class="text-sm text-gray-500">Yesterday, 3:45 PM</span>
                </div>
                <p class="text-sm text-gray-600 mt-1">Your monthly dividend of ₹620 has been processed and will arrive in your account in 2-3 business days.</p>
              </div>
            </div>
          </div>

          <div class="dashboard-card p-4 animate-fade-in" style="animation-delay: 0.2s;">
            <div class="flex items-start space-x-3">
              <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-500">
                <i class="fas fa-bell"></i>
              </div>
              <div class="flex-1">
                <div class="flex justify-between">
                  <h4 class="font-medium">New Milking Record</h4>
                  <span class="text-sm text-gray-500">May 3, 2023, 8:20 AM</span>
                </div>
                <p class="text-sm text-gray-600 mt-1">Bella has set a new personal record with 35 liters of milk production yesterday.</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Upcoming Events -->
        <div class="space-y-4">
          <h3 class="text-xl font-semibold">Upcoming Events</h3>
          
          <div class="dashboard-card p-4 border-l-4 border-purple-600">
            <h4 class="font-medium">Quarterly Health Check</h4>
            <p class="text-sm text-gray-600 mt-1">Comprehensive health examination for all cattle</p>
            <p class="text-sm text-gray-500 mt-2">May 20, 2023</p>
          </div>

          <div class="dashboard-card p-4 border-l-4 border-yellow-500">
            <h4 class="font-medium">Farm Visit Day</h4>
            <p class="text-sm text-gray-600 mt-1">Open day for investors to visit the farm and see their cattle</p>
            <p class="text-sm text-gray-500 mt-2">June 15, 2023</p>
          </div>

          <div class="dashboard-card p-4 border-l-4 border-blue-500">
            <h4 class="font-medium">Investor Webinar</h4>
            <p class="text-sm text-gray-600 mt-1">Online presentation on farm performance and market trends</p>
            <p class="text-sm text-gray-500 mt-2">June 28, 2023</p>
          </div>

          <div class="dashboard-card p-4 border-l-4 border-purple-400">
            <h4 class="font-medium">Dividend Payment</h4>
            <p class="text-sm text-gray-600 mt-1">Next monthly dividend payment date</p>
            <p class="text-sm text-gray-500 mt-2">July 5, 2023</p>
          </div>

          <!-- Motivational Quote -->
          <div class="dashboard-card p-4 bg-gradient-to-r from-purple-50 to-blue-50">
            <p class="italic text-gray-700">"The best time to plant a tree was 20 years ago. The second best time is now."</p>
            <p class="text-right text-sm text-gray-500 mt-2">— Chinese Proverb</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer mt-auto">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div class="space-y-4">
          <h3 class="text-2xl font-bold text-purple-600">DairyVest</h3>
          <p class="text-gray-500">
            Invest in cattle, earn from dairy products, and monitor your investment with real-time updates.
          </p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-500 hover:text-purple-600 transition-colors">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="text-gray-500 hover:text-purple-600 transition-colors">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="text-gray-500 hover:text-purple-600 transition-colors">
              <i class="fab fa-instagram"></i>
            </a>
          </div>
        </div>

        <div class="space-y-4">
          <h4 class="font-semibold text-lg">Quick Links</h4>
          <ul class="space-y-2">
            <li>
              <a href="home_page.html" class="text-gray-500 hover:text-purple-600 transition-colors">Home</a>
            </li>
            <li>
              <a href="dashboard.html" class="text-gray-500 hover:text-purple-600 transition-colors">Dashboard</a>
            </li>
            <li>
              <a href="store.html" class="text-gray-500 hover:text-purple-600 transition-colors">Store</a>
            </li>
            <li>
              <a href="login.html" class="text-gray-500 hover:text-purple-600 transition-colors">Login</a>
            </li>
          </ul>
        </div>

        <div class="space-y-4">
          <h4 class="font-semibold text-lg">Resources</h4>
          <ul class="space-y-2">
            <li>
              <a href="#" class="text-gray-500 hover:text-purple-600 transition-colors">How It Works</a>
            </li>
            <li>
              <a href="#" class="text-gray-500 hover:text-purple-600 transition-colors">FAQs</a>
            </li>
            <li>
              <a href="#" class="text-gray-500 hover:text-purple-600 transition-colors">Blog</a>
            </li>
            <li>
              <a href="#" class="text-gray-500 hover:text-purple-600 transition-colors">Terms & Conditions</a>
            </li>
          </ul>
        </div>

        <div class="space-y-4">
          <h4 class="font-semibold text-lg">Contact Us</h4>
          <ul class="space-y-2">
            <li class="flex items-center space-x-2">
              <i class="fas fa-envelope text-purple-600"></i>
              <span class="text-gray-500">info@dairyvest.com</span>
            </li>
            <li class="flex items-center space-x-2">
              <i class="fas fa-phone text-purple-600"></i>
              <span class="text-gray-500">+1 (234) 567-8901</span>
            </li>
            <li class="flex items-start space-x-2">
              <i class="fas fa-map-marker-alt text-purple-600 mt-1"></i>
              <span class="text-gray-500">123 Dairy Farm Road, Cattle County, CA 90210</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-200 mt-12 py-6 text-center text-gray-500">
        <p>&copy; 2025 DairyVest. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Modal -->
  <div id="liveFeedModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Live Farm Data Feed</h2>
        <span class="close" id="closeLiveFeed">&times;</span>
      </div>
      <p class="text-gray-500 mb-4">Real-time data from farm operations and cattle monitoring.</p>
      
      <div class="flex justify-between items-center mb-4">
        <div class="flex gap-3">
          <div class="flex items-center gap-1">
            <span class="text-blue-500">🥛</span>
            <span class="text-xs">Milk</span>
          </div>
          <div class="flex items-center gap-1">
            <span class="text-green-500">🩺</span>
            <span class="text-xs">Health</span>
          </div>
          <div class="flex items-center gap-1">
            <span class="text-yellow-500">🌾</span>
            <span class="text-xs">Feed</span>
          </div>
          <div class="flex items-center gap-1">
            <span class="text-purple-500">⚙️</span>
            <span class="text-xs">System</span>
          </div>
        </div>
        
        <div class="flex items-center gap-2">
          <span class="text-xs text-gray-500">Auto-refresh</span>
          <button id="autoRefreshBtn" class="px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700">
            On
          </button>
        </div>
      </div>
      
      <hr class="my-4">
      
      <div id="liveFeedContent" class="h-[400px] overflow-y-auto custom-scrollbar pr-2 space-y-2">
        <div class="animate-pulse flex justify-center items-center h-full">
          <div class="flex items-center">
            <i class="fas fa-sync-alt fa-spin mr-2 text-gray-500"></i>
            <span>Loading feed data...</span>
          </div>
        </div>
      </div>
      
      <div class="mt-4 text-right">
        <button id="closeFeedBtn" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">Close Feed</button>
      </div>
    </div>
  </div>

  <script>
    // Initialize Charts
    window.onload = function() {
      // Set iframe heights to match content without scrollbars
      const frameIds = [
        'profit-forecast-frame', 
        'milking-efficiency-frame', 
        'farm-stats-frame', 
        'expense-breakdown-frame',
        'milk-wastage-frame', 
        'cattle-lifecycle-frame', 
        'weather-impact-frame', 
        'waste-to-profit-frame',
        'investor-trust-frame', 
        'cattleIframe'
      ];
      
      frameIds.forEach(id => {
        const iframe = document.getElementById(id);
        if (iframe) {
          iframe.classList.add('no-scroll-iframe');
          
          // Initialize default height
          iframe.style.height = '400px';
        }
      });
      
      // Listen for resize messages from iframes
      window.addEventListener('message', function(event) {
        if (event.data && event.data.type === 'resize') {
          const height = event.data.height;
          const iframes = document.querySelectorAll('iframe.content-iframe');
          
          // Find the frame that sent the message by matching its content window
          for (let i = 0; i < iframes.length; i++) {
            try {
              if (iframes[i].contentWindow === event.source) {
                // Add a small buffer to avoid scrolling
                iframes[i].style.height = (height + 20) + 'px';
                break;
              }
            } catch (e) {
              console.error('Error matching iframe:', e);
            }
          }
        }
      });
      
      // Cattle filter and sort functionality
      const cattleFilter = document.getElementById('cattleFilter');
      const sortOrder = document.getElementById('sortOrder');
      const cattleIframe = document.getElementById('cattleIframe');
      
      function updateCattleFilters() {
        if (cattleIframe && cattleIframe.contentWindow) {
          try {
            cattleIframe.contentWindow.postMessage({
              type: 'updateCattleFilter',
              filter: cattleFilter.value,
              sort: sortOrder.value
            }, '*');
            showToast('Cattle filter applied: ' + cattleFilter.options[cattleFilter.selectedIndex].text);
          } catch (e) {
            console.error('Error sending message to iframe:', e);
            showToast('Failed to update cattle filter', 'error');
          }
        }
      }
      
      // Add listeners for filter changes
      if (cattleFilter) {
        cattleFilter.addEventListener('change', updateCattleFilters);
      }
      
      if (sortOrder) {
        sortOrder.addEventListener('change', updateCattleFilters);
      }
      
      // Milk Production Chart
      const milkProductionCtx = document.getElementById('milkProductionChart').getContext('2d');
      const milkProductionData = {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        datasets: [{
          label: 'Production (Liters)',
          data: [420, 380, 450, 470, 520, 540, 560, 590, 610, 640, 630, 650],
          backgroundColor: 'rgba(139, 92, 246, 0.2)',
          borderColor: '#8B5CF6',
          borderWidth: 2,
          pointBackgroundColor: '#8B5CF6',
          pointRadius: 0,
          pointHoverRadius: 6,
          tension: 0.4
        }]
      };
      
      const milkProductionChart = new Chart(milkProductionCtx, {
        type: 'line',
        data: milkProductionData,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: false,
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                callback: function(value) {
                  return value + 'L';
                }
              }
            },
            x: {
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              }
            }
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': ' + context.raw + ' liters';
                }
              }
            }
          },
          interaction: {
            mode: 'index',
            intersect: false
          }
        }
      });

      // Export dropdown functionality
      const exportBtn = document.getElementById('exportBtn');
      const exportDropdown = document.getElementById('exportDropdown');
      
      exportBtn.addEventListener('click', function() {
        exportDropdown.classList.toggle('hidden');
      });
      
      document.addEventListener('click', function(event) {
        if (!exportBtn.contains(event.target) && !exportDropdown.contains(event.target)) {
          exportDropdown.classList.add('hidden');
        }
      });

      // Live Feed functionality
      const liveFeedBtn = document.getElementById('liveFeedBtn');
      const liveFeedModal = document.getElementById('liveFeedModal');
      const closeLiveFeed = document.getElementById('closeLiveFeed');
      const closeFeedBtn = document.getElementById('closeFeedBtn');
      const liveFeedContent = document.getElementById('liveFeedContent');
      const autoRefreshBtn = document.getElementById('autoRefreshBtn');
      let autoRefresh = true;
      let autoRefreshInterval;
      
      liveFeedBtn.addEventListener('click', function() {
        liveFeedModal.style.display = 'block';
        generateLiveFeedEvents();
        
        if (autoRefresh) {
          startAutoRefresh();
        }
      });
      
      closeLiveFeed.addEventListener('click', function() {
        liveFeedModal.style.display = 'none';
        clearInterval(autoRefreshInterval);
      });
      
      closeFeedBtn.addEventListener('click', function() {
        liveFeedModal.style.display = 'none';
        clearInterval(autoRefreshInterval);
      });
      
      autoRefreshBtn.addEventListener('click', function() {
        autoRefresh = !autoRefresh;
        autoRefreshBtn.textContent = autoRefresh ? 'On' : 'Off';
        
        if (autoRefresh) {
          autoRefreshBtn.classList.remove('bg-gray-200');
          autoRefreshBtn.classList.add('bg-purple-600');
          startAutoRefresh();
        } else {
          autoRefreshBtn.classList.remove('bg-purple-600');
          autoRefreshBtn.classList.add('bg-gray-200');
          clearInterval(autoRefreshInterval);
        }
      });
      
      function startAutoRefresh() {
        autoRefreshInterval = setInterval(function() {
          addNewEvent();
          showToast("New data received in live feed");
        }, 15000);
      }
      
      function generateLiveFeedEvents() {
        const eventTypes = ['milk', 'health', 'feed', 'system'];
        const messages = {
          milk: [
            'Bella produced 12.5 liters in morning session',
            'Daisy produced 10.8 liters in morning session',
            'Rosie produced 11.2 liters in morning session',
            'Mabel produced 9.9 liters in morning session',
            'Total morning collection: 44.4 liters',
            'Tank temperature: 4°C (optimal)'
          ],
          health: [
            'Bella\'s temperature: 38.5°C (normal)',
            'Daisy\'s temperature: 39.0°C (normal)',
            'Rosie requires deworming next week',
            'Mabel\'s vaccination completed',
            'All cattle clearing morning health checks'
          ],
          feed: [
            'Morning feed dispensed: 240kg',
            'Feed quality check passed',
            'Water consumption: 380 liters',
            'Silage stock check: 75% remaining',
            'Mineral supplement added to feed'
          ],
          system: [
            'Milking system sanitization complete',
            'Cooling system operating at optimal temperature',
            'Barn humidity: 65% (acceptable range)',
            'Barn temperature: 22°C (optimal)',
            'Farm manager logged maintenance check'
          ]
        };
        
        liveFeedContent.innerHTML = '';
        
        // Create 20 random events
        for (let i = 0; i < 20; i++) {
          const type = eventTypes[Math.floor(Math.random() * eventTypes.length)];
          const messageList = messages[type];
          const message = messageList[Math.floor(Math.random() * messageList.length)];
          
          // Events in the last 30 minutes
          const now = new Date();
          const timestamp = new Date(now.getTime() - Math.random() * 30 * 60 * 1000);
          
          addEventToFeed({
            id: `event-${i}`,
            type,
            message,
            timestamp
          });
        }
      }
      
      function getEventIcon(type) {
        switch(type) {
          case 'milk':
            return '<span class="text-blue-500">🥛</span>';
          case 'health':
            return '<span class="text-green-500">🩺</span>';
          case 'feed':
            return '<span class="text-yellow-500">🌾</span>';
          case 'system':
            return '<span class="text-purple-500">⚙️</span>';
          default:
            return '<span>📊</span>';
        }
      }
      
      function formatTime(date) {
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      }
      
      function addEventToFeed(event) {
        const eventElement = document.createElement('div');
        eventElement.className = 'flex items-start gap-2 p-2 hover:bg-gray-100 rounded-md';
        eventElement.innerHTML = `
          <div class="mt-0.5">
            ${getEventIcon(event.type)}
          </div>
          <div class="flex-1">
            <p class="text-sm">${event.message}</p>
            <p class="text-xs text-gray-500">${formatTime(event.timestamp)}</p>
          </div>
        `;
        
        liveFeedContent.insertBefore(eventElement, liveFeedContent.firstChild);
      }
      
      function addNewEvent() {
        const eventTypes = ['milk', 'health', 'feed', 'system'];
        const type = eventTypes[Math.floor(Math.random() * eventTypes.length)];
        
        const messages = {
          milk: ['Milk production updated', 'New milk collection recorded', 'Milk quality check completed'],
          health: ['Health status updated', 'Medication administered', 'Animal wellness check completed'],
          feed: ['Feed consumption measured', 'New feed batch prepared', 'Feed inventory updated'],
          system: ['System check complete', 'Sensors calibrated', 'Maintenance task completed']
        };
        
        const message = messages[type][Math.floor(Math.random() * messages[type].length)];
        
        const newEvent = {
          id: `event-${Date.now()}`,
          type,
          message: message,
          timestamp: new Date()
        };
        
        addEventToFeed(newEvent);
      }
      
      function exportData(format) {
        showToast(`Exporting data as ${format.toUpperCase()}...`);
        
        // Simulate export delay
        setTimeout(() => {
          showToast(`Dashboard data has been exported as ${format.toUpperCase()} successfully`, 'success');
        }, 1500);
        
        exportDropdown.classList.add('hidden');
      }
      
      function showToast(message, type = 'info') {
        // Remove existing toasts
        const existingToasts = document.querySelectorAll('.toast');
        existingToasts.forEach(toast => {
          document.body.removeChild(toast);
        });
        
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        const iconClass = type === 'success' ? 'fa-check-circle' : 
                         type === 'error' ? 'fa-exclamation-circle' : 
                         'fa-info-circle';
        
        toast.innerHTML = `
          <i class="fas ${iconClass} mr-2"></i>
          <span>${message}</span>
        `;
        
        document.body.appendChild(toast);
        
        // Show the toast with animation
        setTimeout(() => {
          toast.classList.add('show');
        }, 10);
        
        // Hide and remove after delay
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => {
            if (document.body.contains(toast)) {
              document.body.removeChild(toast);
            }
          }, 300);
        }, 3000);
      }
      
      // Close modal when clicking outside
      window.onclick = function(event) {
        if (event.target == liveFeedModal) {
          liveFeedModal.style.display = "none";
          clearInterval(autoRefreshInterval);
        }
      };
    };
  </script>
</body>
</html>
