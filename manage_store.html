<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dairy-Lift - Store Manager</title>
  <script src="js/auth.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #ad6ef5;
      --primary-foreground: #f8fafc;
      --primary-light: rgba(173, 110, 245, 0.2);
      --background: #ffffff;
      --foreground: #020617;
      --muted: #f1f5f9;
      --muted-foreground: #64748b;
      --border: #e2e8f0;
      --card: #ffffff;
      --card-foreground: #020617;
      --secondary: #c9b458;
      --secondary-foreground: #ffffff;
      --accent: #f2efd1;
      --accent-foreground: #020617;
      --destructive: #ef4444;
      --destructive-foreground: #ffffff;
      --input: #e2e8f0;
      --ring: #ad6ef5;
      --radius: 0.5rem;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      color: var(--foreground);
      background-color: var(--background);
      line-height: 1.5;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    img {
      max-width: 100%;
      height: auto;
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    /* Navbar Styles */
    .navbar {
      background-color: var(--background);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 40;
      border-bottom: 1px solid var(--border);
    }

    .navbar-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 4rem;
      position: relative;
      padding: 0 1rem;
    }

    .logo {
      font-weight: bold;
      font-size: 1.5rem;
      color: var(--primary);
      min-width: 180px;
      text-align: left;
      margin-right: auto;
      display: inline-block;
    }

    .desktop-nav {
      display: none;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    .navbar-actions {
      display: none;
    }

    .mobile-menu-toggle {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      padding: 0.5rem;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      border-radius: 50%;
      transition: all 0.3s ease;
      overflow: hidden;
      z-index: 50;
    }

    .mobile-menu-toggle:hover {
      background-color: var(--primary-light);
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(173, 110, 245, 0.2);
    }

    .mobile-menu-toggle:active {
      transform: scale(0.95);
    }

    .hamburger-lines {
      width: 22px;
      height: 18px;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .hamburger-line {
      display: block;
      height: 2px;
      width: 100%;
      background-color: var(--primary);
      border-radius: 10px;
      transition: all 0.3s ease-in-out;
      transform-origin: center;
    }

    .mobile-menu-toggle.active .hamburger-line:nth-child(1) {
      transform: translateY(8px) rotate(45deg);
      width: 22px;
    }

    .mobile-menu-toggle.active .hamburger-line:nth-child(2) {
      opacity: 0;
      transform: translateX(-10px);
    }

    .mobile-menu-toggle.active .hamburger-line:nth-child(3) {
      transform: translateY(-8px) rotate(-45deg);
      width: 22px;
    }

    .mobile-menu-toggle::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: var(--primary-light);
      border-radius: 50%;
      z-index: -1;
      transform: scale(0);
      transition: transform 0.3s ease;
    }

    .mobile-menu-toggle:hover::after {
      transform: scale(1);
    }

    .menu-toggle-ripple {
      position: absolute;
      background-color: rgba(173, 110, 245, 0.3);
      border-radius: 50%;
      transform: scale(0);
      animation: ripple 0.6s linear;
      pointer-events: none;
    }

    @keyframes ripple {
      to {
        transform: scale(2);
        opacity: 0;
      }
    }

    .mobile-menu {
      position: fixed;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100vh;
      background-color: var(--background);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      padding: 1.5rem 0;
      overflow-y: auto;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border);
    }

    .mobile-menu.active {
      transform: translateX(280px);
    }

    .mobile-menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      backdrop-filter: blur(2px);
    }

    .mobile-menu-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .mobile-nav-link {
      display: flex;
      align-items: center;
      padding: 0.85rem 1.5rem;
      color: var(--foreground);
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
      position: relative;
      margin: 0.25rem 0.75rem;
      border-radius: 0.5rem;
    }

    .mobile-nav-link:hover {
      background-color: var(--muted);
      transform: translateX(5px);
    }

    .mobile-nav-link::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      height: 2px;
      width: 0;
      background-color: var(--primary);
      transition: width 0.3s ease;
    }

    .mobile-nav-link:hover::after {
      width: 30%;
    }

    .mobile-nav-link-primary {
      color: var(--primary);
      font-weight: 600;
      background-color: var(--primary-light);
      margin-top: 0.75rem;
    }

    .mobile-nav-link-primary:hover {
      background-color: var(--primary-light);
      transform: translateX(5px) scale(1.02);
      box-shadow: 0 4px 8px rgba(173, 110, 245, 0.15);
    }

    .mobile-menu-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem 1.5rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1rem;
    }

    .mobile-menu-logo {
      font-family: 'Pacifico', cursive;
      font-size: 1.5rem;
      color: var(--primary);
      text-decoration: none;
    }

    .mobile-menu-close {
      background: none;
      border: none;
      color: var(--muted-foreground);
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s ease;
    }

    .mobile-menu-close:hover {
      background-color: var(--muted);
      color: var(--foreground);
    }

    @media (min-width: 768px) {
      .desktop-nav {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 2.5rem;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: auto;
      }

      .navbar-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .nav-link {
        position: relative;
        padding: 0.5rem 0;
        color: var(--foreground);
        transition: color 0.3s;
      }

      .nav-link:hover {
        color: var(--primary);
      }

      .nav-link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background-color: var(--primary);
        transition: width 0.3s;
      }

      .nav-link:hover::after {
        width: 100%;
      }

      .icon-link {
        padding: 0.5rem;
        color: var(--foreground);
        transition: color 0.3s;
      }

      .icon-link:hover {
        color: var(--primary);
      }
    }

    .navbar-links {
      display: flex;
      gap: 1.5rem;
    }

    .navbar-link {
      text-decoration: none;
      color: var(--foreground);
      font-weight: 500;
      transition: color 0.2s;
    }

    .navbar-link {
      position: relative;
      padding: 0.5rem 0;
      transition: color 0.3s;
    }

    .navbar-link:hover {
      color: var(--primary);
    }

    .navbar-link.active {
      color: var(--primary);
    }

    .navbar-link::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background-color: var(--primary);
      transition: width 0.3s;
    }

    .navbar-link:hover::after {
      width: 100%;
    }

    .navbar-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
      justify-content: flex-end;
      min-width: 180px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius);
      font-weight: 500;
      padding: 0.5rem 1rem;
      transition: all 0.3s ease;
      cursor: pointer;
      border: none;
    }

    .btn-primary {
      background-color: var(--primary);
      color: var(--primary-foreground);
    }

    .btn-primary:hover {
      background-color: #9b55e0;
      box-shadow: 0 3px 10px rgba(173, 110, 245, 0.2);
    }

    .btn-icon {
      width: 2rem;
      height: 2rem;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cart-button {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: transparent;
      border: none;
      color: var(--foreground);
    }

    .cart-button:hover {
      color: var(--primary);
    }

    .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: var(--primary);
      color: var(--primary-foreground);
      font-size: 0.75rem;
      height: 20px;
      width: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 500;
    }

    /* Main Content */
    .main-container {
      min-height: 100vh;
      padding: 2rem 0;
    }

    .panel {
      background-color: white;
      border-radius: 0.75rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
      overflow: hidden;
    }

    .panel-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #e5e7eb;
      background: linear-gradient(to right, #fff7ed, #ffedd5);
      display: flex;
      align-items: center;
    }

    .panel-icon {
      width: 2.5rem;
      height: 2.5rem;
      background-color: #fff7ed;
      border-radius: 9999px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .panel-icon svg {
      width: 1.25rem;
      height: 1.25rem;
      color: #f97316;
    }

    .panel-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1f2937;
    }

    .panel-subtitle {
      font-size: 0.875rem;
      color: #6b7280;
    }

    .panel-body {
      padding: 1rem 1.5rem;
    }

    /* Dashboard Stats */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    @media (min-width: 640px) {
      .stats-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .stats-container {
        grid-template-columns: repeat(5, 1fr);
      }
    }

    .stat-card {
      background-color: white;
      border-radius: 0.375rem;
      border: 1px solid #e5e7eb;
      padding: 1rem;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .stat-card-inner {
      display: flex;
      align-items: center;
    }

    .stat-icon {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 9999px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 0.75rem;
    }

    .stat-label {
      font-size: 0.875rem;
      color: #6b7280;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 600;
      line-height: 1.25;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      gap: 0.5rem;
    }

    .btn:hover {
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-primary {
      background-color: #f97316;
      color: white;
    }

    .btn-primary:hover {
      background-color: #ea580c;
    }

    .btn-outline {
      background-color: white;
      color: #374151;
      border: 1px solid #e5e7eb;
    }

    .btn-outline:hover {
      background-color: #f9fafb;
    }

    .btn-icon {
      width: 2rem;
      height: 2rem;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-icon svg {
      width: 1rem;
      height: 1rem;
    }

    .btn-danger {
      background-color: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background-color: #dc2626;
    }

    /* Product Table Styles */
    .table-header {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    @media (min-width: 640px) {
      .table-header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }
    }

    .table-title {
      font-size: 1.125rem;
      font-weight: 500;
    }

    .search-filter-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      width: 100%;
    }

    @media (min-width: 640px) {
      .search-filter-container {
        flex-direction: row;
        align-items: center;
        width: auto;
      }
    }

    .search-container {
      position: relative;
    }

    .search-input {
      padding: 0.5rem 0.75rem;
      padding-left: 2.25rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      width: 100%;
      min-width: 200px;
    }

    .search-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      width: 0.875rem;
      height: 0.875rem;
    }

    .filter-select {
      padding: 0.5rem 2.25rem 0.5rem 0.75rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      background-color: white;
      background-image: url('data:image/svg+xml;charset=utf-8,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'16\' height=\'16\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'%236b7280\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'%3E%3Cpath d=\'m6 9 6 6 6-6\'/%3E%3C/svg%3E');
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1rem;
      appearance: none;
    }

    .table-container {
      overflow-x: auto;
    }

    .product-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    .product-table th {
      padding: 0.75rem 1rem;
      text-align: left;
      font-weight: 500;
      color: #4b5563;
      border-bottom: 1px solid #e5e7eb;
    }

    .product-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #e5e7eb;
      vertical-align: middle;
    }

    .product-table tr:last-child td {
      border-bottom: none;
    }

    .product-table tbody tr:hover {
      background-color: #f9fafb;
    }

    .product-image {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 0.25rem;
      object-fit: cover;
      border: 1px solid #e5e7eb;
      background-color: #f9fafb;
    }

    .product-name {
      font-weight: 500;
      color: #1f2937;
    }

    .product-category {
      display: inline-flex;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      background-color: #f3f4f6;
      color: #4b5563;
    }

    .stock-badge {
      display: inline-flex;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .stock-badge.in-stock {
      background-color: #dcfce7;
      color: #166534;
    }

    .stock-badge.low-stock {
      background-color: #fef9c3;
      color: #854d0e;
    }

    .stock-badge.out-of-stock {
      background-color: #fee2e2;
      color: #b91c1c;
    }

    .action-cell {
      display: flex;
      gap: 0.25rem;
      justify-content: flex-end;
    }

    .empty-state {
      padding: 3rem 1rem;
      text-align: center;
      color: #6b7280;
    }

    .empty-state-icon {
      margin: 0 auto 1rem;
      width: 3rem;
      height: 3rem;
      color: #d1d5db;
    }

    .empty-state-title {
      font-weight: 500;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    /* Modal styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 100;
      padding: 1rem;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background-color: white;
      border-radius: 0.5rem;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .modal-header {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .modal-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #1f2937;
    }

    .modal-description {
      font-size: 0.875rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      border-top: 1px solid #e5e7eb;
    }

    /* Form styles */
    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: #374151;
      margin-bottom: 0.5rem;
    }

    .form-input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: #f97316;
      box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.1);
    }

    .form-select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      appearance: none;
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      padding-right: 2rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-select:focus {
      outline: none;
      border-color: #f97316;
      box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.1);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    @media (min-width: 640px) {
      .form-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .form-grid-full {
      grid-column: 1 / -1;
    }

    /* Image upload styles */
    .image-upload-container {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .image-preview {
      width: 5rem;
      height: 5rem;
      border-radius: 0.375rem;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      background-color: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .upload-button {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.375rem;
      background-color: #f9fafb;
      font-size: 0.875rem;
      color: #374151;
      cursor: pointer;
    }

    .upload-button:hover {
      background-color: #f3f4f6;
    }

    .remove-image-btn {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.75rem;
      color: #ef4444;
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      margin-top: 0.5rem;
    }

    /* Tabs */
    .tabs {
      border-bottom: 1px solid #e5e7eb;
      margin-bottom: 1rem;
      display: flex;
      gap: 0.5rem;
    }

    .tab-button {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      color: #6b7280;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
    }

    .tab-button.active {
      color: #f97316;
      border-bottom-color: #f97316;
    }

    /* Toast notification */
    .toast-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 50;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-width: 320px;
    }

    .toast {
      display: flex;
      padding: 1rem;
      background-color: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transform: translateX(100%);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
    }

    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }

    .toast-success {
      border-left: 4px solid #10b981;
    }

    .toast-error {
      border-left: 4px solid #ef4444;
    }

    .toast-warning {
      border-left: 4px solid #f59e0b;
    }

    .toast-icon {
      flex-shrink: 0;
      margin-right: 0.75rem;
    }

    .toast-content {
      flex-grow: 1;
    }

    .toast-title {
      font-weight: 600;
      font-size: 0.875rem;
      color: #1f2937;
    }

    .toast-message {
      font-size: 0.875rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }

    /* Modal History Styles */
    .history-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .history-table th,
    .history-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }

    .history-table th {
      font-weight: 500;
      color: #6b7280;
    }

    .price-change {
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    .price-up {
      color: #10b981;
    }

    .price-down {
      color: #ef4444;
    }

    .price-neutral {
      color: #9ca3af;
    }

    /* Mobile responsive adjustments */
    @media (max-width: 640px) {
      .panel-body {
        padding: 1rem;
      }

      .product-table th:nth-child(3),
      .product-table td:nth-child(3) {
        display: none;
      }

      .product-table th:nth-child(5),
      .product-table td:nth-child(5) {
        display: none;
      }
    }

    /* Mobile sidebar */
    .mobile-sidebar {
      position: fixed;
      top: 0;
      right: 0;
      width: 250px;
      height: 100vh;
      background-color: white;
      z-index: 100;
      transform: translateX(100%);
      transition: transform 0.3s ease-out;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
      overflow-y: auto;
    }

    .mobile-sidebar.active {
      transform: translateX(0);
    }

    .sidebar-header {
      padding: 1rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .sidebar-body {
      padding: 1rem;
    }

    .sidebar-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 99;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .sidebar-backdrop.active {
      opacity: 1;
      visibility: visible;
    }

    .mobile-nav {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .mobile-nav-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 0.5rem;
      border-radius: 0.375rem;
      text-decoration: none;
      color: #4b5563;
    }

    .mobile-nav-link:hover {
      background-color: #f3f4f6;
    }

    /* Cart and Wishlist Styles */
    .items-center {
      align-items: center;
    }

    .gap-4 {
      gap: 1rem;
    }

    .flex {
      display: flex;
    }

    .relative {
      position: relative;
    }

    .absolute {
      position: absolute;
    }

    .-top-2 {
      top: -0.5rem;
    }

    .-right-2 {
      right: -0.5rem;
    }

    .rounded-full {
      border-radius: 9999px;
    }

    .h-5 {
      height: 1.25rem;
    }

    .w-5 {
      width: 1.25rem;
    }

    .text-xs {
      font-size: 0.75rem;
    }

    .font-bold {
      font-weight: 700;
    }

    .text-white {
      color: white;
    }

    .bg-orange-500 {
      background-color: #f97316;
    }

    .text-gray-600 {
      color: #4b5563;
    }

    .hover\:text-orange-500:hover {
      color: #f97316;
    }

    .transition-all {
      transition-property: all;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 150ms;
    }

    .mobile-nav-icon {
      color: #6b7280;
    }

    /* Utility classes */
    .flex {
      display: flex;
    }

    .items-center {
      align-items: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .mb-4 {
      margin-bottom: 1rem;
    }

    .mb-2 {
      margin-bottom: 0.5rem;
    }

    .gap-2 {
      gap: 0.5rem;
    }

    .w-full {
      width: 100%;
    }

    .text-right {
      text-align: right;
    }

    .text-xs {
      font-size: 0.75rem;
    }

    .text-sm {
      font-size: 0.875rem;
    }

    .text-gray-500 {
      color: #6b7280;
    }

    .font-medium {
      font-weight: 500;
    }

    .hidden {
      display: none;
    }

    @media (min-width: 640px) {
      .sm\:flex {
        display: flex;
      }

      .sm\:hidden {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <header class="navbar" style="padding:10px">
    <div class="container" style="margin:0px">
      <div class="navbar-content">
        <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu">
          <div class="hamburger-lines">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </div>
        </button>
        <a href="#" class="logo" style="font-family: 'Pacifico', cursive; color: var(--primary);">Dairy-Lift</a>
        <nav class="desktop-nav">
          <a href="home_page.html" class="nav-link">Home</a>
          <a href="dashboard.html" class="nav-link">Dashboard</a>
          <a href="storenew.html" class="nav-link">Store</a>
          <a href="admin-dashboard.html" class="nav-link">Admin</a>
        </nav>
        </div>
      </div>
    </div>
    <div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>
    <div class="mobile-menu" id="mobile-menu">
      <div class="mobile-menu-header">
        <a href="home_page.html" class="mobile-menu-logo">Dairy-Lift</a>
        <button class="mobile-menu-close" id="mobile-menu-close" aria-label="Close menu">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <a href="filesforbuycattle/dist/index.html" class="mobile-nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span style="margin-left: 10px;">Buy Cattle</span>
      </a>
      <a href="#" class="mobile-nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
        <span style="margin-left: 10px;">Bio-Gas</span>
      </a>

      <a href="farm-vista-scheduler-flow/dist/index.html" class="mobile-nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
        <span style="margin-left: 10px;">Visit Farm</span>
      </a>
      <a href="navhome.html" class="mobile-nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
          <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
          <line x1="12" y1="22.08" x2="12" y2="12"></line>
        </svg>
        <span style="margin-left: 10px;">Insurance</span>
      </a>
      <a href="admin-dashboard.html" class="mobile-nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
          <path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"></path>
          <polygon points="18 2 22 6 12 16 8 16 8 12 18 2"></polygon>
        </svg>
        <span style="margin-left: 10px;">Register Cattle</span>
      </a>
      <a href="#" class="mobile-nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
          <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
          <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
        </svg>
        <span style="margin-left: 10px;">Contact-Us</span>
      </a>
      <a href="help/home.html" class="mobile-nav-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        <span style="margin-left: 10px;">Support</span>
      </a>
      <a href="login.html" class="mobile-nav-link mobile-nav-link-primary">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2">
          <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
          <polyline points="10 17 15 12 10 7"></polyline>
          <line x1="15" y1="12" x2="3" y2="12"></line>
        </svg>
        <span style="margin-left: 10px;">Login / Register</span>
      </a>
    </div>
    </div>
  </header>

  <!-- Mobile Sidebar -->
  <div class="sidebar-backdrop" id="sidebar-backdrop"></div>
  <div class="mobile-sidebar" id="mobile-sidebar">
    <div class="sidebar-header">
      <h2 class="text-lg font-medium text-orange-500">Dairy-Lift Admin</h2>
    </div>
    <div class="sidebar-body">
      <nav class="mobile-nav">
        <a href="#" class="mobile-nav-link">
          <span class="mobile-nav-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path>
              <path d="M3 6h18"></path>
              <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg>
          </span>
          Store Manager
        </a>
      </nav>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main-container">
    <div class="container">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path>
              <path d="M3 6h18"></path>
              <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg>
          </div>
          <div>
            <h2 class="panel-title">Store Manager</h2>
            <p class="panel-subtitle">Manage your dairy product inventory and sales.</p>
          </div>
        </div>

        <div class="panel-body">
          <!-- Dashboard Stats -->
          <div class="stats-container" id="stats-container">
            <!-- Stats will be populated by JavaScript -->
          </div>

          <!-- Product Table -->
          <div class="table-header">
            <h3 class="table-title">Product Inventory</h3>
            <div class="search-filter-container">
              <div class="search-container">
                <input id="search-input" type="text" placeholder="Search products..." class="search-input">
                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.3-4.3"></path>
                </svg>
              </div>
              <select id="category-filter" class="filter-select">
                <option value="all">All Categories</option>
                <option value="milk">Milk</option>
                <option value="ghee">Ghee</option>
                <option value="yogurt">Yogurt</option>
                <option value="paneer">Paneer</option>
                <option value="butter">Butter</option>
                <option value="cheese">Cheese</option>
                <option value="other">Other</option>
              </select>
              <button id="add-product-btn" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M5 12h14"></path>
                  <path d="M12 5v14"></path>
                </svg>
                Add Product
              </button>
            </div>
          </div>

          <div class="table-container">
            <table class="product-table" id="product-table">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Category</th>
                  <th>Price</th>
                  <th>Stock</th>
                  <th>Status</th>
                  <th class="text-right">Actions</th>
                </tr>
              </thead>
              <tbody id="product-table-body">
                <!-- Products will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Add/Edit Product Modal -->
  <div class="modal" id="product-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">Add New Product</h3>
      </div>
      <div class="modal-body">
        <form id="product-form">
          <div class="form-grid">
            <div class="form-group form-grid-full">
              <label for="product-name" class="form-label">Product Name</label>
              <input type="text" id="product-name" class="form-input" required>
            </div>

            <div class="form-group">
              <label for="product-category" class="form-label">Category</label>
              <select id="product-category" class="form-select" required>
                <option value="">Select category</option>
                <option value="milk">Milk</option>
                <option value="ghee">Ghee</option>
                <option value="yogurt">Yogurt</option>
                <option value="paneer">Paneer</option>
                <option value="butter">Butter</option>
                <option value="cheese">Cheese</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label for="product-price" class="form-label">Price (₹)</label>
              <input type="number" id="product-price" class="form-input" min="0" step="0.01" required>
            </div>

            <div class="form-group">
              <label for="product-stock" class="form-label">Stock Quantity</label>
              <input type="number" id="product-stock" class="form-input" min="0" required>
            </div>

            <div class="form-group">
              <label for="product-discount" class="form-label">Discount (%)</label>
              <input type="number" id="product-discount" class="form-input" min="0" max="100" value="0">
            </div>

            <div class="form-group form-grid-full">
              <label class="form-label">Product Image</label>
              <div class="image-upload-container">
                <div class="image-preview" id="image-preview">
                  <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 24 24' fill='none' stroke='%23d1d5db' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect width='18' height='18' x='3' y='3' rx='2' ry='2'/%3E%3Ccircle cx='9' cy='9' r='2'/%3E%3Cpath d='m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21'/%3E%3C/svg%3E" id="preview-img" alt="Product">
                </div>

                <div class="upload-controls">
                  <label class="upload-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="17 8 12 3 7 8"></polyline>
                      <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    Upload Image
                    <input type="file" id="product-image" accept="image/*" style="display:none;">
                  </label>

                  <button type="button" id="remove-image-btn" class="remove-image-btn" style="display:none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="15" y1="9" x2="9" y2="15"></line>
                      <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                    Remove
                  </button>
                </div>
              </div>
              <p class="text-xs text-gray-500 mt-2">Max size: 2MB. Recommended dimensions: 200x200px.</p>
            </div>
          </div>

          <input type="hidden" id="product-id">
          <input type="hidden" id="product-created-at">
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" id="modal-cancel-btn">Cancel</button>
        <button type="button" class="btn btn-primary" id="modal-save-btn">Save Product</button>
      </div>
    </div>
  </div>

  <!-- Product History Modal -->
  <div class="modal" id="history-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Product History</h3>
        <p class="modal-description" id="history-product-name"></p>
      </div>
      <div class="modal-body">
        <div class="tabs">
          <button class="tab-button active" data-tab="price">Price History</button>
          <button class="tab-button" data-tab="stock">Stock History</button>
        </div>

        <div class="tab-content" id="price-history-tab">
          <table class="history-table" id="price-history-table">
            <thead>
              <tr>
                <th>Date</th>
                <th class="text-right">Price (₹)</th>
                <th class="text-right">Change</th>
              </tr>
            </thead>
            <tbody id="price-history-body">
              <!-- Price history will be populated by JavaScript -->
            </tbody>
          </table>
        </div>

        <div class="tab-content" id="stock-history-tab" style="display:none;">
          <table class="history-table" id="stock-history-table">
            <thead>
              <tr>
                <th>Date</th>
                <th class="text-right">Stock Level</th>
                <th class="text-right">Change</th>
              </tr>
            </thead>
            <tbody id="stock-history-body">
              <!-- Stock history will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" id="history-close-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal" id="delete-modal">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h3 class="modal-title">Confirm Deletion</h3>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete <strong id="delete-product-name"></strong>? This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" id="delete-cancel-btn">Cancel</button>
        <button type="button" class="btn btn-danger" id="delete-confirm-btn">Delete</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container">
    <!-- Toasts will be populated by JavaScript -->
  </div>

  <!-- Supabase Integration -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/supabase-products.js"></script>

  <script>
    // Product Type Definitions (for documentation purposes)
    /*
    type ProductStatus = "in-stock" | "low-stock" | "out-of-stock" | "inactive";
    type ProductCategory = "milk" | "ghee" | "yogurt" | "paneer" | "butter" | "cheese" | "other";

    interface Product {
      id: number;
      name: string;
      price: number;
      stock: number;
      status: ProductStatus;
      category: ProductCategory;
      imageUrl?: string;
      discount?: number;
      active: boolean;
      createdAt: Date;
      updatedAt: Date;
    }

    interface PriceHistoryEntry {
      date: Date;
      price: number;
    }

    interface StockHistoryEntry {
      date: Date;
      stock: number;
      change: number;
    }

    interface ProductHistory {
      productId: number;
      priceHistory: PriceHistoryEntry[];
      stockHistory: StockHistoryEntry[];
    }
    */

    // Global state
    let products = [];
    let productHistory = {};
    let activeHistoryTab = 'price';
    let supabaseInitialized = false;

    // DOM elements
    const productTableBody = document.getElementById('product-table-body');
    const searchInput = document.getElementById('search-input');
    const categoryFilter = document.getElementById('category-filter');
    const statsContainer = document.getElementById('stats-container');

    // Product Modal elements
    const productModal = document.getElementById('product-modal');
    const productForm = document.getElementById('product-form');
    const productNameInput = document.getElementById('product-name');
    const productCategoryInput = document.getElementById('product-category');
    const productPriceInput = document.getElementById('product-price');
    const productStockInput = document.getElementById('product-stock');
    const productDiscountInput = document.getElementById('product-discount');
    const productIdInput = document.getElementById('product-id');
    const productCreatedAtInput = document.getElementById('product-created-at');
    const productImageInput = document.getElementById('product-image');
    const previewImg = document.getElementById('preview-img');
    const removeImageBtn = document.getElementById('remove-image-btn');
    const modalTitle = document.getElementById('modal-title');
    const modalSaveBtn = document.getElementById('modal-save-btn');
    const modalCancelBtn = document.getElementById('modal-cancel-btn');

    // History Modal elements
    const historyModal = document.getElementById('history-modal');
    const historyProductName = document.getElementById('history-product-name');
    const priceHistoryTab = document.getElementById('price-history-tab');
    const stockHistoryTab = document.getElementById('stock-history-tab');
    const priceHistoryBody = document.getElementById('price-history-body');
    const stockHistoryBody = document.getElementById('stock-history-body');
    const historyCloseBtn = document.getElementById('history-close-btn');
    const tabButtons = document.querySelectorAll('.tab-button');

    // Delete Modal elements
    const deleteModal = document.getElementById('delete-modal');
    const deleteProductName = document.getElementById('delete-product-name');
    const deleteConfirmBtn = document.getElementById('delete-confirm-btn');
    const deleteCancelBtn = document.getElementById('delete-cancel-btn');

    // Add Product button
    const addProductBtn = document.getElementById('add-product-btn');

    // Mobile menu
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileSidebar = document.getElementById('mobile-sidebar');
    const sidebarBackdrop = document.getElementById('sidebar-backdrop');

    // =========================
    // Utility functions
    // =========================

    // Format date
    function formatDate(date) {
      const d = new Date(date);
      const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
      return d.toLocaleDateString('en-US', options);
    }

    // Determine product status based on stock
    function determineStatus(stock) {
      if (stock <= 0) return "out-of-stock";
      if (stock <= 10) return "low-stock";
      return "in-stock";
    }

    // Format currency
    function formatCurrency(amount) {
      return '₹' + parseFloat(amount).toFixed(2);
    }

    // Generate a unique ID
    function generateId() {
      return products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
    }

    // =========================
    // Toast notifications
    // =========================

    function showToast(title, message, type = 'success') {
      const toastContainer = document.getElementById('toast-container');

      // Create toast element
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;

      // Set icon based on type
      let iconSvg = '';
      if (type === 'success') {
        iconSvg = `
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-green-500" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        `;
      } else if (type === 'error') {
        iconSvg = `
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
        `;
      } else if (type === 'warning') {
        iconSvg = `
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-500" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
            <path d="M12 9v4"></path>
            <path d="M12 17h.01"></path>
          </svg>
        `;
      }

      // Set toast content
      toast.innerHTML = `
        <div class="toast-icon">
          ${iconSvg}
        </div>
        <div class="toast-content">
          <h4 class="toast-title">${title}</h4>
          <p class="toast-message">${message}</p>
        </div>
      `;

      // Add to container
      toastContainer.appendChild(toast);

      // Animate toast in
      setTimeout(() => {
        toast.classList.add('show');
      }, 10);

      // Auto remove after 3 seconds
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, 3000);
    }

    // =========================
    // Data Management
    // =========================

    // Initialize Supabase and load products
    async function initializeSupabase() {
      try {
        console.log('🔄 Initializing Supabase Products Manager...');

        const initialized = await window.supabaseProductsManager.initialize();
        if (initialized) {
          supabaseInitialized = true;
          console.log('✅ Supabase Products Manager initialized successfully');
          await loadProductsFromDatabase();
        } else {
          throw new Error('Failed to initialize Supabase Products Manager');
        }
      } catch (error) {
        console.error('❌ Failed to initialize Supabase:', error);
        supabaseInitialized = false;
        showToast('Database Connection Failed', 'Using fallback data. Error: ' + error.message, 'error');
        loadFallbackProducts();
      }
    }

    // Load products from Supabase database
    async function loadProductsFromDatabase() {
      try {
        console.log('Loading products from database...');
        const dbProducts = await window.supabaseProductsManager.getAllProducts();

        // Convert database format to local format
        products = dbProducts.map(product => ({
          id: product.id,
          name: product.name,
          description: product.description || '',
          price: parseFloat(product.price),
          stock: product.stock_quantity || 0,
          status: determineStatus(product.stock_quantity || 0),
          category: product.category,
          imageUrl: product.image_url || '',
          discount: 0,
          active: product.is_active,
          createdAt: new Date(product.created_at),
          updatedAt: new Date(product.updated_at)
        }));

        console.log(`✅ Loaded ${products.length} products from database`);
        renderProducts();
        updateStats();

        showToast('Database Connected', `Successfully loaded ${products.length} products from database`, 'success');
      } catch (error) {
        console.error('Error loading products from database:', error);
        showToast('Database Error', 'Failed to load products from database', 'error');
        loadFallbackProducts();
      }
    }

    // Load fallback products when database is unavailable
    function loadFallbackProducts() {
      console.log('Loading fallback products...');
      const storedProducts = localStorage.getItem('dairyliftProducts');

      if (storedProducts) {
        products = JSON.parse(storedProducts, (key, value) => {
          // Convert date strings back to Date objects
          if (key === 'createdAt' || key === 'updatedAt') {
            return new Date(value);
          }
          return value;
        });
      } else {
        // Initialize with demo data
        const now = new Date();
        products = [
          {
            id: 1,
            name: "Fresh Milk (500ml)",
            price: 45,
            stock: 120,
            status: "in-stock",
            category: "milk",
            active: true,
            createdAt: now,
            updatedAt: now
          },
          {
            id: 2,
            name: "Premium Ghee (200g)",
            price: 180,
            stock: 50,
            status: "in-stock",
            category: "ghee",
            active: true,
            createdAt: now,
            updatedAt: now
          },
          {
            id: 3,
            name: "Yogurt (400g)",
            price: 60,
            stock: 85,
            status: "in-stock",
            category: "yogurt",
            active: true,
            createdAt: now,
            updatedAt: now
          },
          {
            id: 4,
            name: "Paneer (250g)",
            price: 120,
            stock: 5,
            status: "low-stock",
            category: "paneer",
            active: true,
            createdAt: now,
            updatedAt: now
          },
          {
            id: 5,
            name: "Butter (100g)",
            price: 75,
            stock: 0,
            status: "out-of-stock",
            category: "butter",
            active: true,
            createdAt: now,
            updatedAt: now
          }
        ];

        saveProducts();
      }

      renderProducts();
      updateStats();
    }

    // Load product history from localStorage or initialize
    function loadProductHistory() {
      const storedHistory = localStorage.getItem('dairyliftProductHistory');

      if (storedHistory) {
        productHistory = JSON.parse(storedHistory, (key, value) => {
          // Convert date strings back to Date objects
          if (key === 'date') {
            return new Date(value);
          }
          return value;
        });
      } else {
        // Initialize history for each product
        const now = new Date();
        products.forEach(product => {
          productHistory[product.id] = {
            productId: product.id,
            priceHistory: [{ date: now, price: product.price }],
            stockHistory: [{ date: now, stock: product.stock, change: product.stock }]
          };
        });

        saveProductHistory();
      }
    }

    // Save products to localStorage
    function saveProducts() {
      localStorage.setItem('dairyliftProducts', JSON.stringify(products));
    }

    // Save product history to localStorage
    function saveProductHistory() {
      localStorage.setItem('dairyliftProductHistory', JSON.stringify(productHistory));
    }

    // Add a new product
    async function addProduct(productData) {
      try {
        if (supabaseInitialized) {
          // Add to Supabase database
          const newProduct = await window.supabaseProductsManager.addProduct(productData);

          // Convert database format to local format and add to local array
          const localProduct = {
            id: newProduct.id,
            name: newProduct.name,
            description: newProduct.description || '',
            price: parseFloat(newProduct.price),
            stock: newProduct.stock_quantity || 0,
            status: determineStatus(newProduct.stock_quantity || 0),
            category: newProduct.category,
            imageUrl: newProduct.image_url || '',
            discount: 0,
            active: newProduct.is_active,
            createdAt: new Date(newProduct.created_at),
            updatedAt: new Date(newProduct.updated_at)
          };

          products.push(localProduct);

          showToast('Success', `${productData.name} has been added to your store and database.`);
        } else {
          // Fallback to localStorage
          const now = new Date();
          const newId = generateId();

          const newProduct = {
            id: newId,
            name: productData.name,
            price: productData.price,
            stock: productData.stock,
            status: determineStatus(productData.stock),
            category: productData.category,
            discount: productData.discount || 0,
            imageUrl: productData.imageUrl || '',
            active: true,
            createdAt: now,
            updatedAt: now
          };

          products.push(newProduct);

          // Initialize history for new product
          productHistory[newId] = {
            productId: newId,
            priceHistory: [{ date: now, price: productData.price }],
            stockHistory: [{ date: now, stock: productData.stock, change: productData.stock }]
          };

          saveProducts();
          saveProductHistory();

          showToast('Success', `${productData.name} has been added to your store (local storage).`);
        }

        renderProducts();
        updateStats();
      } catch (error) {
        console.error('Error adding product:', error);
        showToast('Error', `Failed to add ${productData.name}. ${error.message}`, 'error');
      }
    }

    // Update an existing product
    async function updateProduct(id, productData) {
      try {
        if (supabaseInitialized) {
          // Update in Supabase database
          const updatedProduct = await window.supabaseProductsManager.updateProduct(id, productData);

          // Update local array
          const index = products.findIndex(p => p.id === id);
          if (index !== -1) {
            products[index] = {
              id: updatedProduct.id,
              name: updatedProduct.name,
              description: updatedProduct.description || '',
              price: parseFloat(updatedProduct.price),
              stock: updatedProduct.stock_quantity || 0,
              status: determineStatus(updatedProduct.stock_quantity || 0),
              category: updatedProduct.category,
              imageUrl: updatedProduct.image_url || '',
              discount: 0,
              active: updatedProduct.is_active,
              createdAt: new Date(updatedProduct.created_at),
              updatedAt: new Date(updatedProduct.updated_at)
            };
          }

          showToast('Success', `${productData.name} has been updated in the database.`);
        } else {
          // Fallback to localStorage
          const now = new Date();
          const index = products.findIndex(p => p.id === id);
          if (index === -1) return;

          const oldProduct = products[index];

          const updatedProduct = {
            ...oldProduct,
            name: productData.name,
            price: productData.price,
            stock: productData.stock,
            status: determineStatus(productData.stock),
            category: productData.category,
            discount: productData.discount || 0,
            imageUrl: productData.imageUrl || oldProduct.imageUrl,
            updatedAt: now
          };

          products[index] = updatedProduct;

          // Update product history if price or stock changed
          if (oldProduct.price !== productData.price || oldProduct.stock !== productData.stock) {
            const history = productHistory[id];

            // Only add to history if values actually changed
            if (oldProduct.price !== productData.price) {
              history.priceHistory.push({ date: now, price: productData.price });
            }

            if (oldProduct.stock !== productData.stock) {
              history.stockHistory.push({
                date: now,
                stock: productData.stock,
                change: productData.stock - oldProduct.stock
              });
            }

            productHistory[id] = history;
          }

          saveProducts();
          saveProductHistory();

          showToast('Success', `${productData.name} has been updated (local storage).`);
        }

        renderProducts();
        updateStats();
      } catch (error) {
        console.error('Error updating product:', error);
        showToast('Error', `Failed to update ${productData.name}. ${error.message}`, 'error');
      }
    }

    // Delete a product
    async function deleteProduct(id) {
      try {
        const productToDelete = products.find(p => p.id === id);
        if (!productToDelete) return;

        if (supabaseInitialized) {
          // Delete from Supabase database (soft delete)
          await window.supabaseProductsManager.deleteProduct(id);

          // Remove from local array
          products = products.filter(p => p.id !== id);

          showToast('Product Removed', `${productToDelete.name} has been removed from the database.`);
        } else {
          // Fallback to localStorage
          // Remove the product
          products = products.filter(p => p.id !== id);

          // Remove product history
          delete productHistory[id];

          // Remove any low stock alerts for this product
          localStorage.removeItem(`lowStockAlert-${id}`);

          saveProducts();
          saveProductHistory();

          showToast('Product Removed', `${productToDelete.name} has been removed (local storage).`);
        }

        renderProducts();
        updateStats();
      } catch (error) {
        console.error('Error deleting product:', error);
        showToast('Error', `Failed to delete product. ${error.message}`, 'error');
      }
    }

    // Toggle product active status
    function toggleProductStatus(id) {
      const index = products.findIndex(p => p.id === id);
      if (index === -1) return;

      products[index].active = !products[index].active;
      products[index].updatedAt = new Date();

      saveProducts();

      const status = products[index].active ? 'activated' : 'deactivated';
      showToast('Status Updated', `${products[index].name} has been ${status}.`);
      renderProducts();
    }

    // Check for low stock and show alerts
    function checkLowStock() {
      products.forEach(product => {
        if (product.stock > 0 && product.stock <= 5) {
          const hasShownAlert = localStorage.getItem(`lowStockAlert-${product.id}`);

          if (!hasShownAlert) {
            showToast('Low Stock Alert', `${product.name} is running low (${product.stock} units left)`, 'warning');
            localStorage.setItem(`lowStockAlert-${product.id}`, 'true');
          }
        } else if (product.stock > 5) {
          // Reset the alert if stock goes above threshold
          localStorage.removeItem(`lowStockAlert-${product.id}`);
        }
      });
    }

    // =========================
    // UI Rendering
    // =========================

    // Render products table
    function renderProducts() {
      if (!productTableBody) return;

      // Get filter values
      const searchTerm = searchInput.value.toLowerCase();
      const categoryValue = categoryFilter.value;

      // Apply filters
      const filteredProducts = products.filter(product => {
        // Search term filter
        const matchesSearch = product.name.toLowerCase().includes(searchTerm);

        // Category filter
        const matchesCategory = categoryValue === 'all' || product.category === categoryValue;

        return matchesSearch && matchesCategory;
      });

      // Clear current table rows
      productTableBody.innerHTML = '';

      // Check if no products after filtering
      if (filteredProducts.length === 0) {
        const emptyRow = document.createElement('tr');
        emptyRow.innerHTML = `
          <td colspan="6">
            <div class="empty-state">
              <svg class="empty-state-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"></path>
              </svg>
              <h4 class="empty-state-title">No products found</h4>
              <p>Try adjusting your search or filter to find what you're looking for.</p>
            </div>
          </td>
        `;
        productTableBody.appendChild(emptyRow);
        return;
      }

      // Create table rows
      filteredProducts.forEach(product => {
        const row = document.createElement('tr');

        // Determine status badge class
        let statusBadgeClass = '';
        switch (product.status) {
          case 'in-stock':
            statusBadgeClass = 'in-stock';
            break;
          case 'low-stock':
            statusBadgeClass = 'low-stock';
            break;
          case 'out-of-stock':
            statusBadgeClass = 'out-of-stock';
            break;
        }

        // Get placeholder image
        const placeholderImg = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 24 24' fill='none' stroke='%23d1d5db' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect width='18' height='18' x='3' y='3' rx='2' ry='2'/%3E%3Ccircle cx='9' cy='9' r='2'/%3E%3Cpath d='m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21'/%3E%3C/svg%3E";

        // Render table cell content
        row.innerHTML = `
          <td>
            <div class="flex items-center gap-2">
              <img src="${product.imageUrl || placeholderImg}" alt="${product.name}" class="product-image">
              <span class="product-name">${product.name}</span>
            </div>
          </td>
          <td>
            <span class="product-category">${product.category}</span>
          </td>
          <td>${formatCurrency(product.price)}</td>
          <td>${product.stock}</td>
          <td>
            <span class="stock-badge ${statusBadgeClass}">${product.status.replace('-', ' ')}</span>
          </td>
          <td class="action-cell">
            <button class="btn btn-icon btn-outline history-btn" data-id="${product.id}" title="View History">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 20v-6M6 20V10M18 20V4"></path>
              </svg>
            </button>
            <button class="btn btn-icon btn-outline edit-btn" data-id="${product.id}" title="Edit Product">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
                <path d="m15 5 4 4"></path>
              </svg>
            </button>
            <button class="btn btn-icon btn-outline toggle-btn" data-id="${product.id}" title="${product.active ? 'Deactivate' : 'Activate'}">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 12h6"></path>
                <path d="M12 9v6"></path>
                <circle cx="12" cy="12" r="10"></circle>
              </svg>
            </button>
            <button class="btn btn-icon btn-outline delete-btn" data-id="${product.id}" data-name="${product.name}" title="Delete Product">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18"></path>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
            </button>
          </td>
        `;

        // Add row to table
        productTableBody.appendChild(row);
      });

      // Add event listeners to buttons
      document.querySelectorAll('.history-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const productId = parseInt(btn.getAttribute('data-id'));
          const product = products.find(p => p.id === productId);
          showHistoryModal(product);
        });
      });

      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const productId = parseInt(btn.getAttribute('data-id'));
          const product = products.find(p => p.id === productId);
          showEditModal(product);
        });
      });

      document.querySelectorAll('.toggle-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const productId = parseInt(btn.getAttribute('data-id'));
          toggleProductStatus(productId);
        });
      });

      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const productId = parseInt(btn.getAttribute('data-id'));
          const productName = btn.getAttribute('data-name');
          showDeleteModal(productId, productName);
        });
      });
    }

    // Update dashboard stats
    function updateStats() {
      if (!statsContainer) return;

      const totalProducts = products.length;
      const inStockProducts = products.filter(p => p.status === "in-stock").length;
      const outOfStockProducts = products.filter(p => p.status === "out-of-stock").length;
      const lowStockProducts = products.filter(p => p.status === "low-stock").length;

      // Calculate total inventory value
      const inventoryValue = products.reduce((total, product) => {
        return total + (product.price * product.stock);
      }, 0);

      // Create stats HTML
      statsContainer.innerHTML = `
        <div class="stat-card">
          <div class="stat-card-inner">
            <div class="stat-icon" style="background-color: #fff7ed;">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path>
                <path d="M3 6h18"></path>
                <path d="M16 10a4 4 0 0 1-8 0"></path>
              </svg>
            </div>
            <div>
              <p class="stat-label">Total Products</p>
              <p class="stat-value">${totalProducts}</p>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card-inner">
            <div class="stat-icon" style="background-color: #f0fdf4;">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
            </div>
            <div>
              <p class="stat-label">In Stock</p>
              <p class="stat-value">${inStockProducts}</p>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card-inner">
            <div class="stat-icon" style="background-color: #fefce8;">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#eab308" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                <path d="M12 9v4"></path>
                <path d="M12 17h.01"></path>
              </svg>
            </div>
            <div>
              <p class="stat-label">Low Stock</p>
              <p class="stat-value">${lowStockProducts}</p>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card-inner">
            <div class="stat-icon" style="background-color: #fef2f2;">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
            </div>
            <div>
              <p class="stat-label">Out of Stock</p>
              <p class="stat-value">${outOfStockProducts}</p>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card-inner">
            <div class="stat-icon" style="background-color: #eff6ff;">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"></path>
                <path d="M12 18V6"></path>
              </svg>
            </div>
            <div>
              <p class="stat-label">Inventory Value</p>
              <p class="stat-value">${formatCurrency(inventoryValue)}</p>
            </div>
          </div>
        </div>
      `;
    }

    // =========================
    // Modal Management
    // =========================

    // Show modal for adding a new product
    function showAddModal() {
      // Reset form
      productForm.reset();
      productIdInput.value = '';
      productCreatedAtInput.value = '';
      previewImg.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 24 24' fill='none' stroke='%23d1d5db' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect width='18' height='18' x='3' y='3' rx='2' ry='2'/%3E%3Ccircle cx='9' cy='9' r='2'/%3E%3Cpath d='m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21'/%3E%3C/svg%3E";
      removeImageBtn.style.display = 'none';

      // Update modal title
      modalTitle.textContent = 'Add New Product';
      modalSaveBtn.textContent = 'Add Product';

      // Show modal
      productModal.classList.add('active');
    }

    // Show modal for editing an existing product
    function showEditModal(product) {
      // Populate form with product data
      productNameInput.value = product.name;
      productCategoryInput.value = product.category;
      productPriceInput.value = product.price;
      productStockInput.value = product.stock;
      productDiscountInput.value = product.discount || 0;
      productIdInput.value = product.id;
      productCreatedAtInput.value = product.createdAt;

      // Set product image if exists
      if (product.imageUrl) {
        previewImg.src = product.imageUrl;
        removeImageBtn.style.display = 'flex';
      } else {
        previewImg.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 24 24' fill='none' stroke='%23d1d5db' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect width='18' height='18' x='3' y='3' rx='2' ry='2'/%3E%3Ccircle cx='9' cy='9' r='2'/%3E%3Cpath d='m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21'/%3E%3C/svg%3E";
        removeImageBtn.style.display = 'none';
      }

      // Update modal title
      modalTitle.textContent = 'Edit Product';
      modalSaveBtn.textContent = 'Save Changes';

      // Show modal
      productModal.classList.add('active');
    }

    // Show confirmation dialog for deleting a product
    function showDeleteModal(productId, productName) {
      deleteProductName.textContent = productName;

      // Set product ID to delete button data
      deleteConfirmBtn.setAttribute('data-id', productId);

      // Show modal
      deleteModal.classList.add('active');
    }

    // Show product history modal
    function showHistoryModal(product) {
      if (!product) return;

      // Set product name
      historyProductName.textContent = product.name;

      // Get product history
      const history = productHistory[product.id];
      if (!history) return;

      // Set active tab to price history by default
      document.querySelector('.tab-button[data-tab="price"]').classList.add('active');
      document.querySelector('.tab-button[data-tab="stock"]').classList.remove('active');
      priceHistoryTab.style.display = 'block';
      stockHistoryTab.style.display = 'none';
      activeHistoryTab = 'price';

      // Render price history
      renderPriceHistory(history.priceHistory);

      // Render stock history
      renderStockHistory(history.stockHistory);

      // Show modal
      historyModal.classList.add('active');
    }

    // Render price history table
    function renderPriceHistory(priceHistory) {
      // Sort by date descending
      const sortedHistory = [...priceHistory].sort((a, b) => b.date - a.date);

      // Clear current table rows
      priceHistoryBody.innerHTML = '';

      // Check if no history
      if (sortedHistory.length === 0) {
        const emptyRow = document.createElement('tr');
        emptyRow.innerHTML = `
          <td colspan="3" class="text-center py-4 text-gray-500">
            No price change history available
          </td>
        `;
        priceHistoryBody.appendChild(emptyRow);
        return;
      }

      // Create table rows
      sortedHistory.forEach((entry, index) => {
        const row = document.createElement('tr');

        // Calculate price change
        const prevPrice = index < sortedHistory.length - 1 ? sortedHistory[index + 1].price : entry.price;
        const change = entry.price - prevPrice;

        let changeHtml = '';
        if (index === sortedHistory.length - 1) {
          changeHtml = `
            <span class="price-change price-neutral">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 12h14"></path>
              </svg>
              Initial
            </span>
          `;
        } else if (change > 0) {
          changeHtml = `
            <span class="price-change price-up">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m18 15-6-6-6 6"></path>
              </svg>
              +${formatCurrency(change)}
            </span>
          `;
        } else if (change < 0) {
          changeHtml = `
            <span class="price-change price-down">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m6 9 6 6 6-6"></path>
              </svg>
              ${formatCurrency(change)}
            </span>
          `;
        } else {
          changeHtml = `
            <span class="price-change price-neutral">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 12h14"></path>
              </svg>
              No change
            </span>
          `;
        }

        row.innerHTML = `
          <td>${formatDate(entry.date)}</td>
          <td class="text-right">${formatCurrency(entry.price)}</td>
          <td class="text-right">${changeHtml}</td>
        `;

        priceHistoryBody.appendChild(row);
      });
    }

    // Render stock history table
    function renderStockHistory(stockHistory) {
      // Sort by date descending
      const sortedHistory = [...stockHistory].sort((a, b) => b.date - a.date);

      // Clear current table rows
      stockHistoryBody.innerHTML = '';

      // Check if no history
      if (sortedHistory.length === 0) {
        const emptyRow = document.createElement('tr');
        emptyRow.innerHTML = `
          <td colspan="3" class="text-center py-4 text-gray-500">
            No stock change history available
          </td>
        `;
        stockHistoryBody.appendChild(emptyRow);
        return;
      }

      // Create table rows
      sortedHistory.forEach((entry, index) => {
        const row = document.createElement('tr');

        let changeHtml = '';
        if (index === sortedHistory.length - 1) {
          changeHtml = `
            <span class="price-change price-neutral">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 12h14"></path>
              </svg>
              Initial
            </span>
          `;
        } else if (entry.change > 0) {
          changeHtml = `
            <span class="price-change price-up">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m18 15-6-6-6 6"></path>
              </svg>
              +${entry.change}
            </span>
          `;
        } else if (entry.change < 0) {
          changeHtml = `
            <span class="price-change price-down">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m6 9 6 6 6-6"></path>
              </svg>
              ${entry.change}
            </span>
          `;
        } else {
          changeHtml = `
            <span class="price-change price-neutral">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 12h14"></path>
              </svg>
              No change
            </span>
          `;
        }

        row.innerHTML = `
          <td>${formatDate(entry.date)}</td>
          <td class="text-right">${entry.stock}</td>
          <td class="text-right">${changeHtml}</td>
        `;

        stockHistoryBody.appendChild(row);
      });
    }

    // =========================
    // Event Handlers
    // =========================

    // Handle form submission for adding/editing products
    function handleProductFormSubmit() {
      // Get form data
      const name = productNameInput.value;
      const category = productCategoryInput.value;
      const price = parseFloat(productPriceInput.value);
      const stock = parseInt(productStockInput.value);
      const discount = parseInt(productDiscountInput.value) || 0;

      // Validate form data
      if (!name || !category || isNaN(price) || isNaN(stock)) {
        showToast('Error', 'Please fill all required fields correctly', 'error');
        return;
      }

      // Get the preview image (if any)
      const imageUrl = previewImg.src;
      const isPlaceholder = imageUrl.includes('data:image/svg+xml');

      // Prepare product data
      const productData = {
        name,
        category,
        price,
        stock,
        discount,
        imageUrl: isPlaceholder ? '' : imageUrl
      };

      // Check if adding or editing
      const productId = parseInt(productIdInput.value);
      if (productId) {
        // Update existing product
        updateProduct(productId, productData);
      } else {
        // Add new product
        addProduct(productData);
      }

      // Close modal
      productModal.classList.remove('active');
    }

    // Handle image upload
    function handleImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      // Validate file size (max 2MB)
      if (file.size > 2 * 1024 * 1024) {
        showToast('Error', 'Image file size must be less than 2MB', 'error');
        return;
      }

      // Read file as data URL
      const reader = new FileReader();
      reader.onload = function(e) {
        previewImg.src = e.target.result;
        removeImageBtn.style.display = 'flex';
      };
      reader.readAsDataURL(file);
    }

    // Handle image removal
    function handleRemoveImage() {
      previewImg.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 24 24' fill='none' stroke='%23d1d5db' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect width='18' height='18' x='3' y='3' rx='2' ry='2'/%3E%3Ccircle cx='9' cy='9' r='2'/%3E%3Cpath d='m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21'/%3E%3C/svg%3E";
      removeImageBtn.style.display = 'none';
      productImageInput.value = '';
    }

    // Handle tab switching in history modal
    function handleTabSwitch(e) {
      const tabName = e.target.getAttribute('data-tab');

      // Update active tab button
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      e.target.classList.add('active');

      // Show/hide tab content
      if (tabName === 'price') {
        priceHistoryTab.style.display = 'block';
        stockHistoryTab.style.display = 'none';
        activeHistoryTab = 'price';
      } else if (tabName === 'stock') {
        priceHistoryTab.style.display = 'none';
        stockHistoryTab.style.display = 'block';
        activeHistoryTab = 'stock';
      }
    }

    // Handle delete confirmation
    function handleDeleteConfirm() {
      const productId = parseInt(deleteConfirmBtn.getAttribute('data-id'));
      if (productId) {
        deleteProduct(productId);
      }
      deleteModal.classList.remove('active');
    }

    // =========================
    // Event Listeners
    // =========================

    // Initialize event listeners
    function initEventListeners() {
      // Search and filter
      if (searchInput) {
        searchInput.addEventListener('input', renderProducts);
      }

      if (categoryFilter) {
        categoryFilter.addEventListener('change', renderProducts);
      }

      // Add Product button
      if (addProductBtn) {
        addProductBtn.addEventListener('click', showAddModal);
      }

      // Product form save button
      if (modalSaveBtn) {
        modalSaveBtn.addEventListener('click', handleProductFormSubmit);
      }

      // Product form cancel button
      if (modalCancelBtn) {
        modalCancelBtn.addEventListener('click', () => {
          productModal.classList.remove('active');
        });
      }

      // Image upload
      if (productImageInput) {
        productImageInput.addEventListener('change', handleImageUpload);
      }

      // Remove image button
      if (removeImageBtn) {
        removeImageBtn.addEventListener('click', handleRemoveImage);
      }

      // Tab buttons in history modal
      if (tabButtons) {
        tabButtons.forEach(btn => {
          btn.addEventListener('click', handleTabSwitch);
        });
      }

      // History modal close button
      if (historyCloseBtn) {
        historyCloseBtn.addEventListener('click', () => {
          historyModal.classList.remove('active');
        });
      }

      // Delete modal buttons
      if (deleteConfirmBtn) {
        deleteConfirmBtn.addEventListener('click', handleDeleteConfirm);
      }

      if (deleteCancelBtn) {
        deleteCancelBtn.addEventListener('click', () => {
          deleteModal.classList.remove('active');
        });
      }

      // Mobile menu
      if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', () => {
          mobileSidebar.classList.add('active');
          sidebarBackdrop.classList.add('active');
        });
      }

      if (sidebarBackdrop) {
        sidebarBackdrop.addEventListener('click', () => {
          mobileSidebar.classList.remove('active');
          sidebarBackdrop.classList.remove('active');
        });
      }

      // Close modals when clicking outside
      window.addEventListener('click', (e) => {
        if (e.target === productModal) {
          productModal.classList.remove('active');
        }
        if (e.target === historyModal) {
          historyModal.classList.remove('active');
        }
        if (e.target === deleteModal) {
          deleteModal.classList.remove('active');
        }
      });
    }

    // =========================
    // Initialization
    // =========================

    // Initialize app
    async function init() {
      try {
        // Set up event listeners first
        initEventListeners();

        // Initialize Supabase and load data
        await initializeSupabase();

        // Load product history (for fallback mode)
        loadProductHistory();

        // Check for low stock
        checkLowStock();
      } catch (error) {
        console.error('Error during initialization:', error);
        showToast('Initialization Error', 'Some features may not work properly', 'warning');
      }
    }

    // Start the app
    document.addEventListener('DOMContentLoaded', init);

    // Mobile menu functionality
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      const mobileMenuClose = document.getElementById('mobile-menu-close');
      const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
      const body = document.body;

      // Function to open mobile menu
      function openMobileMenu() {
        mobileMenu.classList.add('active');
        mobileMenuOverlay.classList.add('active');
        mobileMenuToggle.classList.add('active');
        body.style.overflow = 'hidden'; // Prevent scrolling when menu is open

        // Add a subtle ripple effect on click
        const ripple = document.createElement('span');
        ripple.classList.add('menu-toggle-ripple');
        mobileMenuToggle.appendChild(ripple);

        // Position the ripple where the click happened
        const rect = mobileMenuToggle.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height) * 2;

        ripple.style.width = ripple.style.height = `${size}px`;
        ripple.style.left = `${-size/4}px`;
        ripple.style.top = `${-size/4}px`;

        // Remove the ripple after animation completes
        setTimeout(() => {
          ripple.remove();
        }, 600);

        // Add entrance animation to each nav link
        const navLinks = mobileMenu.querySelectorAll('.mobile-nav-link');
        navLinks.forEach((link, index) => {
          link.style.opacity = '0';
          link.style.transform = 'translateX(-10px)';
          link.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
          link.style.transitionDelay = `${0.05 * (index + 1)}s`;

          setTimeout(() => {
            link.style.opacity = '1';
            link.style.transform = 'translateX(0)';
          }, 10);
        });
      }

      // Function to close mobile menu
      function closeMobileMenu() {
        mobileMenu.classList.remove('active');
        if (mobileMenuOverlay) mobileMenuOverlay.classList.remove('active');
        mobileMenuToggle.classList.remove('active');
        body.style.overflow = ''; // Restore scrolling
      }

      // Toggle menu when clicking the hamburger button
      if (mobileMenuToggle && mobileMenu) {
        mobileMenuToggle.addEventListener('click', function(event) {
          event.stopPropagation();
          if (mobileMenu.classList.contains('active')) {
            closeMobileMenu();
          } else {
            openMobileMenu();
          }
        });
      }

      // Close menu when clicking the close button
      if (mobileMenuClose) {
        mobileMenuClose.addEventListener('click', closeMobileMenu);
      }

      // Close menu when clicking the overlay
      if (mobileMenuOverlay) {
        mobileMenuOverlay.addEventListener('click', closeMobileMenu);
      }

      // Close mobile menu when clicking on a link
      const mobileLinks = document.querySelectorAll('.mobile-nav-link');
      mobileLinks.forEach(link => {
        link.addEventListener('click', closeMobileMenu);
      });

      // Close mobile menu when pressing Escape key
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && mobileMenu && mobileMenu.classList.contains('active')) {
          closeMobileMenu();
        }
      });

      // Cart functionality
      updateCartCount();

      // Cart toggle button event listener
      const cartToggle = document.getElementById('cart-toggle');
      if (cartToggle) {
        cartToggle.addEventListener('click', function() {
          window.location.href = 'cart.html';
        });
      }
    });

    // Update cart count from localStorage
    function updateCartCount() {
      const cartCountElement = document.getElementById('cart-count');
      if (cartCountElement) {
        const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
        cartCountElement.textContent = cartItems.length;
      }
    }

    // Initialize authentication when DOM is loaded
    if (window.DairyLiftAuth) {
      console.log('Auth script loaded, initializing...');
      window.DairyLiftAuth.initAuth();
    } else {
      console.log('Auth script not loaded, trying to initialize...');
      // Try to initialize auth after a short delay
      setTimeout(function() {
        if (typeof initAuth === 'function') {
          initAuth();
        } else {
          console.error('Auth initialization function not found');
        }
      }, 500);
    }

    // Also try to initialize on window load
    window.addEventListener('load', function() {
      if (typeof initAuth === 'function') {
        initAuth();
      }
    });
  </script>
</body>
</html>
