<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Authentication Sync - Main Repository</title>
  <script src="js/auth.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .navbar {
      background: #f5f5f5;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .navbar-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary {
      background: #ad6ef5;
      color: white;
    }
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .status.logged-in {
      background: #d4edda;
      color: #155724;
    }
    .status.logged-out {
      background: #f8d7da;
      color: #721c24;
    }
    .links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }
    .links-grid a {
      padding: 8px 12px;
      background: #e9ecef;
      border-radius: 4px;
      text-decoration: none;
      color: #495057;
      font-size: 14px;
    }
    .links-grid a:hover {
      background: #dee2e6;
    }
    .section-title {
      color: #495057;
      font-weight: bold;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Main Repository Authentication Sync Test</h1>

  <div class="test-section">
    <h2>Current Status</h2>
    <div id="auth-status" class="status">Checking...</div>
  </div>

  <div class="test-section">
    <h2>Test Navigation Bar</h2>
    <div class="navbar">
      <div class="navbar-actions">
        <a href="login.html" class="btn btn-primary">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          Login
        </a>
      </div>
    </div>
  </div>

  <div class="test-section">
    <h2>Test Controls</h2>
    <button id="simulate-login" class="btn btn-primary">Simulate Login</button>
    <button id="simulate-logout" class="btn btn-secondary">Simulate Logout</button>
    <button id="force-update" class="btn btn-secondary">Force UI Update</button>
  </div>

  <div class="test-section">
    <h2>Profile Icon Test</h2>
    <p>Profile icon should appear here when logged in:</p>
    <div id="profile-test-area" style="min-height: 50px; border: 1px dashed #ccc; padding: 10px;">
      <!-- Profile icon will be inserted here -->
    </div>
  </div>

  <div class="test-section">
    <h2>Main Repository Pages to Test</h2>
    <div class="section-title">Navigation Pages:</div>
    <div class="links-grid">
      <a href="home_page.html" target="_blank">Home Page</a>
      <a href="navhome.html" target="_blank">Nav Home</a>
      <a href="navclaims.html" target="_blank">Nav Claims</a>
      <a href="navplans.html" target="_blank">Nav Plans</a>
      <a href="navregister-cattle.html" target="_blank">Nav Register Cattle</a>
      <a href="dashboard.html" target="_blank">Dashboard</a>
      <a href="YourCattle.html" target="_blank">Your Cattle</a>
    </div>

    <div class="section-title">Profile & Settings:</div>
    <div class="links-grid">
      <a href="profile.html" target="_blank">Profile</a>
      <a href="settings.html" target="_blank">Settings</a>
      <a href="login.html" target="_blank">Login</a>
      <a href="register.html" target="_blank">Register</a>
    </div>

    <div class="section-title">Store & Inventory:</div>
    <div class="links-grid">
      <a href="cartstore.html" target="_blank">Cart Store</a>
      <a href="cattleinventory.html" target="_blank">Cattle Inventory</a>
      <a href="watchliststore.html" target="_blank">Watchlist Store</a>
      <a href="manage_store.html" target="_blank">Manage Store</a>
    </div>

    <div class="section-title">Other Pages:</div>
    <div class="links-grid">
      <a href="aboutus.html" target="_blank">About Us</a>
      <a href="viewdetailsofcattle.html" target="_blank">View Cattle Details</a>
      <a href="indexadmin.html" target="_blank">Admin Index</a>
      <a href="new_investor.html" target="_blank">New Investor</a>
    </div>

    <div class="section-title">✅ All Updated Files (Now with auth.js):</div>
    <div style="background: #d4edda; padding: 10px; border-radius: 4px; margin: 10px 0; font-size: 12px;">
      <strong>Main Repository Files Updated:</strong><br>
      ✅ navhome.html, navclaims.html, navplans.html, navregister-cattle.html<br>
      ✅ aboutus.html, cattleinventory.html, settings.html<br>
      ✅ viewdetailsofcattle.html, manage_store.html, indexadmin.html, new_investor.html<br>
      ✅ cartstore.html, profile.html, home_page.html, dashboard.html, YourCattle.html, watchliststore.html, login.html, register.html (already had auth.js)
    </div>
  </div>

  <div class="test-section">
    <h2>FOR-INVESTORS Comparison</h2>
    <div class="section-title">FOR-INVESTORS Pages (Should be Independent):</div>
    <div class="links-grid">
      <a href="FOR-INVESTORS/home_page.html" target="_blank">FOR-INVESTORS Home</a>
      <a href="FOR-INVESTORS/dashboard.html" target="_blank">FOR-INVESTORS Dashboard</a>
      <a href="FOR-INVESTORS/filesforbuycattle/dist/index.html" target="_blank">Buy Cattle (React)</a>
      <a href="FOR-INVESTORS/test-auth-sync.html" target="_blank">FOR-INVESTORS Test Page</a>
    </div>
  </div>

  <div class="test-section">
    <h2>Expected Behavior</h2>
    <ul>
      <li><strong>Main Repository Sync:</strong> Login/logout in any main repository page should sync across all main repository pages</li>
      <li><strong>Profile Icon:</strong> Should use <code>image/profileicone.png</code> with SVG fallback</li>
      <li><strong>Cross-Tab Sync:</strong> Changes in one main repository tab should immediately update all other main repository tabs</li>
      <li><strong>Independence:</strong> Main repository authentication should be completely separate from FOR-INVESTORS authentication</li>
      <li><strong>Persistence:</strong> Profile icon should remain visible when navigating between main repository pages</li>
    </ul>
  </div>

  <script>
    function updateStatus() {
      const statusEl = document.getElementById('auth-status');
      const isLoggedIn = window.isLoggedIn ? window.isLoggedIn() : false;

      if (isLoggedIn) {
        statusEl.textContent = 'User is logged in (Main Repository)';
        statusEl.className = 'status logged-in';
      } else {
        statusEl.textContent = 'User is not logged in (Main Repository)';
        statusEl.className = 'status logged-out';
      }
    }

    function testProfileIcon() {
      const testArea = document.getElementById('profile-test-area');
      const existingIcon = testArea.querySelector('#profile-icon-link');

      if (existingIcon) {
        testArea.removeChild(existingIcon);
      }

      if (window.isLoggedIn && window.isLoggedIn()) {
        // Create a test profile icon
        const profileLink = document.createElement('a');
        profileLink.href = 'profile.html';
        profileLink.id = 'profile-icon-link';
        profileLink.style.display = 'flex';
        profileLink.style.alignItems = 'center';
        profileLink.style.justifyContent = 'center';
        profileLink.style.width = '40px';
        profileLink.style.height = '40px';
        profileLink.style.borderRadius = '50%';
        profileLink.style.backgroundColor = 'rgba(173, 110, 245, 0.2)';
        profileLink.style.border = '2px solid rgba(173, 110, 245, 0.3)';
        profileLink.style.overflow = 'hidden';

        const profileImage = document.createElement('img');
        profileImage.src = 'image/profileicone.png';
        profileImage.alt = 'Profile';
        profileImage.style.width = '100%';
        profileImage.style.height = '100%';
        profileImage.style.objectFit = 'cover';
        profileImage.style.borderRadius = '50%';

        profileImage.onerror = function() {
          // Fallback to SVG if image fails to load
          profileLink.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
              stroke="#ad6ef5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          `;
        };

        profileLink.appendChild(profileImage);
        testArea.appendChild(profileLink);
      }
    }

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Main repository test page loaded');

      // Initialize auth
      if (window.initAuth) {
        window.initAuth();
      }

      updateStatus();
      testProfileIcon();

      // Set up event listeners
      document.getElementById('simulate-login').addEventListener('click', function() {
        // Simulate login by setting auth data
        localStorage.setItem('dairyLift_auth', JSON.stringify({
          name: 'Main User',
          email: 'user@example.com',
          timestamp: Date.now(),
          role: 'user'
        }));

        updateStatus();
        testProfileIcon();

        // Force UI update
        if (window.updateAuthUI) {
          window.updateAuthUI();
        }
      });

      document.getElementById('simulate-logout').addEventListener('click', function() {
        // Simulate logout
        localStorage.removeItem('dairyLift_auth');

        updateStatus();
        testProfileIcon();

        // Force UI update
        if (window.updateAuthUI) {
          window.updateAuthUI();
        }
      });

      document.getElementById('force-update').addEventListener('click', function() {
        if (window.updateAuthUI) {
          window.updateAuthUI();
        }
        updateStatus();
        testProfileIcon();
      });
    });

    // Listen for auth changes
    window.addEventListener('storage', function(event) {
      if (event.key === 'dairyLift_auth') {
        updateStatus();
        testProfileIcon();
      }
    });
  </script>
</body>
</html>
