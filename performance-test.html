<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dairy-Lift Performance Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .metric:last-child {
            border-bottom: none;
        }
        .status {
            padding: 5px 10px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
        }
        .status.good { background: #4CAF50; }
        .status.warning { background: #FF9800; }
        .status.error { background: #F44336; }
        .test-button {
            background: #ad6ef5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #9b55e0;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ðŸš€ Dairy-Lift Performance Test Dashboard</h1>
    
    <div class="test-container">
        <h2>Performance Managers Status</h2>
        <div id="manager-status">
            <div class="metric">
                <span>Performance Manager:</span>
                <span id="perf-manager-status" class="status">Loading...</span>
            </div>
            <div class="metric">
                <span>Animation Manager:</span>
                <span id="anim-manager-status" class="status">Loading...</span>
            </div>
            <div class="metric">
                <span>Supabase Products Manager:</span>
                <span id="supabase-manager-status" class="status">Loading...</span>
            </div>
            <div class="metric">
                <span>Global Optimizations:</span>
                <span id="global-opt-status" class="status">Loading...</span>
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2>Performance Metrics</h2>
        <div id="performance-metrics">
            <div class="metric">
                <span>Cache Size:</span>
                <span id="cache-size">-</span>
            </div>
            <div class="metric">
                <span>Active Timers:</span>
                <span id="active-timers">-</span>
            </div>
            <div class="metric">
                <span>Memory Usage:</span>
                <span id="memory-usage">-</span>
            </div>
            <div class="metric">
                <span>Page Visibility:</span>
                <span id="page-visibility">-</span>
            </div>
            <div class="metric">
                <span>Network Status:</span>
                <span id="network-status">-</span>
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2>Performance Tests</h2>
        <button class="test-button" onclick="testCaching()">Test Caching</button>
        <button class="test-button" onclick="testDebouncing()">Test Debouncing</button>
        <button class="test-button" onclick="testAnimations()">Test Animations</button>
        <button class="test-button" onclick="testRefreshRates()">Test Refresh Rates</button>
        <button class="test-button" onclick="clearLogs()">Clear Logs</button>
        
        <div class="log" id="test-logs">
            <div>Performance test dashboard initialized...</div>
        </div>
    </div>

    <!-- Load optimization scripts -->
    <script src="js/global-optimizations.js"></script>
    <script src="js/performance-manager.js"></script>
    <script src="js/animation-manager.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-products.js"></script>

    <script>
        let testLogs = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            testLogs.push(logMessage);
            
            const logContainer = document.getElementById('test-logs');
            const logDiv = document.createElement('div');
            logDiv.textContent = logMessage;
            logContainer.appendChild(logDiv);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLogs() {
            testLogs = [];
            document.getElementById('test-logs').innerHTML = '<div>Logs cleared...</div>';
        }

        function updateStatus() {
            // Check Performance Manager
            const perfStatus = document.getElementById('perf-manager-status');
            if (window.performanceManager) {
                perfStatus.textContent = 'Active';
                perfStatus.className = 'status good';
            } else {
                perfStatus.textContent = 'Not Found';
                perfStatus.className = 'status error';
            }

            // Check Animation Manager
            const animStatus = document.getElementById('anim-manager-status');
            if (window.animationManager) {
                animStatus.textContent = 'Active';
                animStatus.className = 'status good';
            } else {
                animStatus.textContent = 'Not Found';
                animStatus.className = 'status error';
            }

            // Check Supabase Products Manager
            const supabaseStatus = document.getElementById('supabase-manager-status');
            if (window.supabaseProductsManager) {
                supabaseStatus.textContent = 'Active';
                supabaseStatus.className = 'status good';
            } else {
                supabaseStatus.textContent = 'Not Found';
                supabaseStatus.className = 'status error';
            }

            // Check Global Optimizations
            const globalStatus = document.getElementById('global-opt-status');
            if (window.globalOptimizations && window.globalOptimizations.isOptimized()) {
                globalStatus.textContent = 'Active';
                globalStatus.className = 'status good';
            } else {
                globalStatus.textContent = 'Not Active';
                globalStatus.className = 'status warning';
            }
        }

        function updateMetrics() {
            if (window.performanceManager) {
                const metrics = window.performanceManager.getMetrics();
                
                document.getElementById('cache-size').textContent = metrics.cacheSize || 0;
                document.getElementById('active-timers').textContent = metrics.activeTimers || 0;
                document.getElementById('page-visibility').textContent = metrics.isVisible ? 'Visible' : 'Hidden';
                document.getElementById('network-status').textContent = metrics.networkStatus || 'Unknown';
                
                if (metrics.memory) {
                    document.getElementById('memory-usage').textContent = 
                        `${metrics.memory.used}MB / ${metrics.memory.limit}MB`;
                } else {
                    document.getElementById('memory-usage').textContent = 'Not Available';
                }
            }
        }

        function testCaching() {
            log('Testing caching functionality...');
            
            if (!window.performanceManager) {
                log('âŒ Performance Manager not found');
                return;
            }

            // Test cache set/get
            const testData = { test: 'data', timestamp: Date.now() };
            window.performanceManager.setCache('test-key', testData);
            
            const retrieved = window.performanceManager.getCache('test-key');
            if (retrieved && retrieved.test === 'data') {
                log('âœ… Cache set/get working correctly');
            } else {
                log('âŒ Cache set/get failed');
            }

            // Test cache expiration
            window.performanceManager.setCache('expire-test', 'data', 100); // 100ms timeout
            setTimeout(() => {
                const expired = window.performanceManager.getCache('expire-test');
                if (expired === null) {
                    log('âœ… Cache expiration working correctly');
                } else {
                    log('âŒ Cache expiration failed');
                }
            }, 150);
        }

        function testDebouncing() {
            log('Testing debouncing functionality...');
            
            if (!window.performanceManager) {
                log('âŒ Performance Manager not found');
                return;
            }

            let callCount = 0;
            const testFunction = () => {
                callCount++;
                log(`Debounced function called (count: ${callCount})`);
            };

            // Call debounced function multiple times rapidly
            for (let i = 0; i < 5; i++) {
                window.performanceManager.debounce('test-debounce', testFunction, 200);
            }

            setTimeout(() => {
                if (callCount === 1) {
                    log('âœ… Debouncing working correctly (5 calls â†’ 1 execution)');
                } else {
                    log(`âŒ Debouncing failed (expected 1 call, got ${callCount})`);
                }
            }, 300);
        }

        function testAnimations() {
            log('Testing animation functionality...');
            
            if (!window.animationManager) {
                log('âŒ Animation Manager not found');
                return;
            }

            const metrics = window.animationManager.getMetrics();
            log(`Animation Manager Status: ${JSON.stringify(metrics)}`);

            // Create test element
            const testElement = document.createElement('div');
            testElement.style.cssText = 'width: 50px; height: 50px; background: #ad6ef5; margin: 10px;';
            document.body.appendChild(testElement);

            // Test fade in
            window.animationManager.fadeIn(testElement, 300).then(() => {
                log('âœ… Fade in animation completed');
                
                // Test slide in
                return window.animationManager.slideIn(testElement, 'up', 300);
            }).then(() => {
                log('âœ… Slide in animation completed');
                
                // Clean up
                setTimeout(() => {
                    testElement.remove();
                }, 1000);
            }).catch(error => {
                log(`âŒ Animation test failed: ${error.message}`);
            });
        }

        function testRefreshRates() {
            log('Testing adaptive refresh rates...');
            
            let refreshCount = 0;
            let lastRefreshTime = Date.now();
            
            const testRefresh = () => {
                const now = Date.now();
                const interval = now - lastRefreshTime;
                refreshCount++;
                
                log(`Refresh #${refreshCount} - Interval: ${interval}ms`);
                lastRefreshTime = now;
                
                if (refreshCount < 5) {
                    // Simulate adaptive interval
                    const nextInterval = refreshCount * 1000; // Increasing intervals
                    setTimeout(testRefresh, nextInterval);
                } else {
                    log('âœ… Adaptive refresh rate test completed');
                }
            };
            
            testRefresh();
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            log('Performance test dashboard loaded');
            
            // Update status immediately and then every 2 seconds
            updateStatus();
            updateMetrics();
            
            setInterval(() => {
                updateStatus();
                updateMetrics();
            }, 2000);
            
            log('Dashboard monitoring started');
        });

        // Monitor page visibility changes
        document.addEventListener('visibilitychange', function() {
            log(`Page visibility changed: ${document.visibilityState}`);
        });

        // Monitor network status
        window.addEventListener('online', () => log('Network: Online'));
        window.addEventListener('offline', () => log('Network: Offline'));
    </script>
</body>
</html>
